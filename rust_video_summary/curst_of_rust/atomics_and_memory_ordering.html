<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Atomics and Memory Ordering - The Rust Programming Language</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../md-favicon.png">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/general.css">
    <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../highlight.css">
    <link rel="stylesheet" href="../../tomorrow-night.css">
    <link rel="stylesheet" href="../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../assets/ferris/ferris.css">
        <link rel="stylesheet" href="../../theme/2018-edition.css">
        <link rel="stylesheet" href="../../assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="../../assets/css/mdbook-admonish.css">

</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "../../";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('navy')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="../../not_involved_resources.html"><strong aria-hidden="true">1.</strong> Not Involved Resources</a></li><li class="chapter-item expanded "><a href="../../overviews.html"><strong aria-hidden="true">2.</strong> Overviews</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../overviews/rbe_radial_tree_embed.html"><strong aria-hidden="true">2.1.</strong> Rust By Examples</a></li></ol></li><li class="chapter-item expanded "><a href="../../title-page.html"><strong aria-hidden="true">3.</strong> Rust Topics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../cheat_sheets/cheat_sheets.html"><strong aria-hidden="true">3.1.</strong> Cheat Sheets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../cheat_sheets/rust_language_cheat_sheet.html"><strong aria-hidden="true">3.1.1.</strong> Rust Language Cheat Sheet</a></li><li class="chapter-item "><a href="../../cheat_sheets/quick_ref_me_rust.html"><strong aria-hidden="true">3.1.2.</strong> Quick Ref Me Rust</a></li><li class="chapter-item "><a href="../../cheat_sheets/phaiax_rust_cheet_sheet.html"><strong aria-hidden="true">3.1.3.</strong> Phaiax Rust Cheet Sheet</a></li></ol></li><li class="chapter-item "><a href="../../chatgpt_rust/chatgpt_rust_prompts.html"><strong aria-hidden="true">3.2.</strong> chatGPT Rust Q&A</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chatgpt_rust/rust_grammar_experience_pitfalls.html"><strong aria-hidden="true">3.2.1.</strong> Experience & Pitfall</a></li></ol></li><li class="chapter-item expanded "><a href="../../rust_video_summary/rust_video_summary.html"><strong aria-hidden="true">3.3.</strong> Rust Video Summary</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/code_to_the_moon/code_to_the_moon.html"><strong aria-hidden="true">3.3.1.</strong> Code to the Moon</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/learn_rust_programming.html"><strong aria-hidden="true">3.3.2.</strong> Learn Rust Programming</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/ownership_and_borrow_checker.html"><strong aria-hidden="true">3.3.2.1.</strong> Ownership and borrow checker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/what_is_ownership_in_rust.html"><strong aria-hidden="true">3.3.2.1.1.</strong> What is Ownership in Rust?</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/what_is_rust_borrow_checker_and_why_is_it_useful.html"><strong aria-hidden="true">3.3.2.1.2.</strong> What is Rust Borrow-checker and why is it useful</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/types.html"><strong aria-hidden="true">3.3.2.2.</strong> Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/what_is_the_difference_between_string_and_str_in_rust.html"><strong aria-hidden="true">3.3.2.2.1.</strong> What is the difference between String and &str in rust</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/why_enums_are_your_superpower.html"><strong aria-hidden="true">3.3.2.2.2.</strong> Why Enums are your superpower</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/implementing_the_trie_data_structure_in_rust.html"><strong aria-hidden="true">3.3.2.2.3.</strong> Implementing The Trie Data Structure In Rust</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/rust_polymorphism.html"><strong aria-hidden="true">3.3.2.3.</strong> Rust Polymorphism</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/rust_polymorphism_generics_and_trait_objects_explained.html"><strong aria-hidden="true">3.3.2.3.1.</strong> Rust Polymorphism: Generics and Trait Objects explained</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/introducing_traits_in_rust_what_they_are_and_how_to_use_them.html"><strong aria-hidden="true">3.3.2.3.2.</strong> Introducing traits in rust: what they are and how to use them</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/rust_programming_for_the_object_oriented_developer.html"><strong aria-hidden="true">3.3.2.3.3.</strong> Rust Programming for The Object-Oriented Developer</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/error_and_test.html"><strong aria-hidden="true">3.3.2.4.</strong> Error & Test</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/all_about_error_handling_in_the_rust_programming_language.html"><strong aria-hidden="true">3.3.2.4.1.</strong> All About Error Handling in the Rust Programming Language</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/unit_testing_basics.html"><strong aria-hidden="true">3.3.2.4.2.</strong> Unit Testing Basics</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/iterate.html"><strong aria-hidden="true">3.3.2.5.</strong> Iterate</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/introducing_iterators_in_rust.html"><strong aria-hidden="true">3.3.2.5.1.</strong> Introducing iterators in rust</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/how_to_implement_the_intoiterator_trait.html"><strong aria-hidden="true">3.3.2.5.2.</strong> How to implement the intoiterator trait</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/implementing_iterators_in_rust_creating_a_random_number_generator.html"><strong aria-hidden="true">3.3.2.5.3.</strong> Implementing Iterators in rust & creating a random number generator</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/qa_and_code_review.html"><strong aria-hidden="true">3.3.2.6.</strong> QA & Code Review</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/answers_to_stackoverflow_top_rust_programming_questions_explained.html"><strong aria-hidden="true">3.3.2.6.1.</strong> Answers to StackOverflow Top Rust Programming Questions Explained</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/conducting_a_code_review_of_the_jwtinfo_crate.html"><strong aria-hidden="true">3.3.2.6.2.</strong> Conducting a code review of the jwtinfo crate</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/happy_little_fractals_coding_the_mandelbrot_set_in_rust.html"><strong aria-hidden="true">3.3.2.6.3.</strong> Happy little fractals coding the Mandelbrot set in Rust</a></li><li class="chapter-item "><a href="../../rust_video_summary/learn_rust_programming/rust_programming_qa.html"><strong aria-hidden="true">3.3.2.6.4.</strong> Rust Programming Q&A</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/considering_rust.html"><strong aria-hidden="true">3.3.3.</strong> Considering Rust</a></li><li class="chapter-item expanded "><a href="../../rust_video_summary/curst_of_rust/crust_of_rust.html"><strong aria-hidden="true">3.3.4.</strong> Crust Of Rust Series</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/async_await.html"><strong aria-hidden="true">3.3.4.1.</strong> Async/Await</a></li><li class="chapter-item expanded "><a href="../../rust_video_summary/curst_of_rust/atomics_and_memory_ordering.html" class="active"><strong aria-hidden="true">3.3.4.2.</strong> Atomics and Memory Ordering</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/channels.html"><strong aria-hidden="true">3.3.4.3.</strong> Channels</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/declarative_macros.html"><strong aria-hidden="true">3.3.4.4.</strong> Declarative Macros</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/dispatch_and_fat_pointers.html"><strong aria-hidden="true">3.3.4.5.</strong> Dispatch and Fat Pointers</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/functions_closures_and_their_traits.html"><strong aria-hidden="true">3.3.4.6.</strong> Functions, Closures and their traits</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/iterators.html"><strong aria-hidden="true">3.3.4.7.</strong> Iterators</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/lifetime_annotations.html"><strong aria-hidden="true">3.3.4.8.</strong> Lifetime Annotations</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/smart_pointers_and_interior_mutability.html"><strong aria-hidden="true">3.3.4.9.</strong> Smart Pointers And Interior Mutability</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/sorting_algorithms.html"><strong aria-hidden="true">3.3.4.10.</strong> Sorting Algorithms</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/subtyping_and_variance.html"><strong aria-hidden="true">3.3.4.11.</strong> Subtyping and Variance</a></li><li class="chapter-item "><a href="../../rust_video_summary/curst_of_rust/the_drop_check.html"><strong aria-hidden="true">3.3.4.12.</strong> The Drop Check</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/implementing_hazard_pointers_in_rust/implementing_hazard_pointers.html"><strong aria-hidden="true">3.3.5.</strong> Implementing Hazard Pointers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/implementing_hazard_pointers_in_rust/part1.html"><strong aria-hidden="true">3.3.5.1.</strong> Part 1</a></li><li class="chapter-item "><a href="../../rust_video_summary/implementing_hazard_pointers_in_rust/part2.html"><strong aria-hidden="true">3.3.5.2.</strong> Part 2</a></li><li class="chapter-item "><a href="../../rust_video_summary/implementing_hazard_pointers_in_rust/part3.html"><strong aria-hidden="true">3.3.5.3.</strong> Part 3</a></li><li class="chapter-item "><a href="../../rust_video_summary/implementing_hazard_pointers_in_rust/part4.html"><strong aria-hidden="true">3.3.5.4.</strong> Part 4</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/impl_rust/impl_rust.html"><strong aria-hidden="true">3.3.6.</strong> Impl Rust</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/impl_rust/solving_distributed_system_challenges_in_rust.html"><strong aria-hidden="true">3.3.6.1.</strong> Solving Distributed System Challenges</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/open_source_streams/open_source_streams.html"><strong aria-hidden="true">3.3.7.</strong> Open-Source streams</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_video_summary/open_source_streams/rust_open_source_contributions_stream.html"><strong aria-hidden="true">3.3.7.1.</strong> Rust Open Source Contributions Stream</a></li><li class="chapter-item "><a href="../../rust_video_summary/open_source_streams/rust_tools_and_std_future.html"><strong aria-hidden="true">3.3.7.2.</strong> Rust Toos and std::future</a></li><li class="chapter-item "><a href="../../rust_video_summary/open_source_streams/day_in_the_life_of_open_source_maintenance_2022_06_19.html"><strong aria-hidden="true">3.3.7.3.</strong> Day in the life of Open Source Maintenance 2022-06-19</a></li><li class="chapter-item "><a href="../../rust_video_summary/open_source_streams/day_in_the_life_of_open_source_maintenance_2022_10_08.html"><strong aria-hidden="true">3.3.7.4.</strong> Day in the life of Open Source Maintenance 2022-10-08</a></li></ol></li><li class="chapter-item "><a href="../../rust_video_summary/stop_duplicating_your_code.html"><strong aria-hidden="true">3.3.8.</strong> Stop Duplicating Your Code</a></li><li class="chapter-item "><a href="../../rust_video_summary/rust_crash_course_rustlang.html"><strong aria-hidden="true">3.3.9.</strong> Rust Crash Course</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.</strong> Associated Items</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../topics/at_gat.html"><strong aria-hidden="true">3.4.1.</strong> Associated type, Generic associate types</a></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.2.</strong> Associated Types</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/assoc_items/types.html"><strong aria-hidden="true">3.4.2.1.</strong> Associated types examples</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.3.</strong> Generic Associated Types</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.4.</strong> Associated Functions & Methods</div></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../title-page.html"><strong aria-hidden="true">4.</strong> The Rust Programming Language</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../foreword.html"><strong aria-hidden="true">4.1.</strong> Foreword</a></li><li class="chapter-item "><a href="../../ch00-00-introduction.html"><strong aria-hidden="true">4.2.</strong> Introduction</a></li><li class="chapter-item "><a href="../../ch01-00-getting-started.html"><strong aria-hidden="true">4.3.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch01-01-installation.html"><strong aria-hidden="true">4.3.1.</strong> Installation</a></li><li class="chapter-item "><a href="../../ch01-02-hello-world.html"><strong aria-hidden="true">4.3.2.</strong> Hello, World!</a></li><li class="chapter-item "><a href="../../ch01-03-hello-cargo.html"><strong aria-hidden="true">4.3.3.</strong> Hello, Cargo!</a></li><li class="chapter-item "><a href="../../ch02-00-guessing-game-tutorial.html"><strong aria-hidden="true">4.3.4.</strong> Programming a Guessing Game</a></li><li class="chapter-item "><a href="../../ch03-00-common-programming-concepts.html"><strong aria-hidden="true">4.3.5.</strong> Common Programming Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch03-01-variables-and-mutability.html"><strong aria-hidden="true">4.3.5.1.</strong> ⚠️Variables and Mutability</a></li><li class="chapter-item "><a href="../../ch03-02-data-types.html"><strong aria-hidden="true">4.3.5.2.</strong> Data Types</a></li><li class="chapter-item "><a href="../../rust_by_example_src/expression.html"><strong aria-hidden="true">4.3.5.3.</strong> RBE(Rust by Examples): Expressions and Statements</a></li><li class="chapter-item "><a href="../../ch03-03-how-functions-work.html"><strong aria-hidden="true">4.3.5.4.</strong> ✨Functions Basic: Statements, Expressions, Last Return, Early Return</a></li><li class="chapter-item "><a href="../../ch03-04-comments.html"><strong aria-hidden="true">4.3.5.5.</strong> Comments</a></li><li class="chapter-item "><a href="../../ch03-05-control-flow.html"><strong aria-hidden="true">4.3.5.6.</strong> Control Flow</a></li></ol></li><li class="chapter-item "><a href="../../ch04-00-understanding-ownership.html"><strong aria-hidden="true">4.3.6.</strong> Understanding Ownership</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch04-01-what-is-ownership.html"><strong aria-hidden="true">4.3.6.1.</strong> What is Ownership?</a></li><li class="chapter-item "><a href="../../ch04-02-references-and-borrowing.html"><strong aria-hidden="true">4.3.6.2.</strong> References and Borrowing</a></li><li class="chapter-item "><a href="../../ch04-03-slices.html"><strong aria-hidden="true">4.3.6.3.</strong> The Slice Type</a></li></ol></li><li class="chapter-item "><a href="../../ch05-00-structs.html"><strong aria-hidden="true">4.3.7.</strong> Using Structs to Structure Related Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch05-01-defining-structs.html"><strong aria-hidden="true">4.3.7.1.</strong> Defining and Instantiating Structs</a></li><li class="chapter-item "><a href="../../ch05-02-example-structs.html"><strong aria-hidden="true">4.3.7.2.</strong> An Example Program Using Structs</a></li><li class="chapter-item "><a href="../../ch05-03-method-syntax.html"><strong aria-hidden="true">4.3.7.3.</strong> ✨Method Syntax</a></li></ol></li><li class="chapter-item "><a href="../../ch06-00-enums.html"><strong aria-hidden="true">4.3.8.</strong> Enums and Pattern Matching</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch06-01-defining-an-enum.html"><strong aria-hidden="true">4.3.8.1.</strong> Defining an Enum</a></li><li class="chapter-item "><a href="../../ch06-02-match.html"><strong aria-hidden="true">4.3.8.2.</strong> The match Control Flow Construct</a></li><li class="chapter-item "><a href="../../ch06-03-if-let.html"><strong aria-hidden="true">4.3.8.3.</strong> Concise Control Flow with if let</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">4.4.</strong> Basic Rust Literacy</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch07-00-managing-growing-projects-with-packages-crates-and-modules.html"><strong aria-hidden="true">4.4.1.</strong> Managing Growing Projects with Packages, Crates, and Modules</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch07-01-packages-and-crates.html"><strong aria-hidden="true">4.4.1.1.</strong> Packages and Crates</a></li><li class="chapter-item "><a href="../../ch07-02-defining-modules-to-control-scope-and-privacy.html"><strong aria-hidden="true">4.4.1.2.</strong> Defining Modules to Control Scope and Privacy</a></li><li class="chapter-item "><a href="../../ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html"><strong aria-hidden="true">4.4.1.3.</strong> Paths for Referring to an Item in the Module Tree</a></li><li class="chapter-item "><a href="../../ch07-04-bringing-paths-into-scope-with-the-use-keyword.html"><strong aria-hidden="true">4.4.1.4.</strong> Bringing Paths Into Scope with the use Keyword</a></li><li class="chapter-item "><a href="../../ch07-05-separating-modules-into-different-files.html"><strong aria-hidden="true">4.4.1.5.</strong> Separating Modules into Different Files</a></li></ol></li><li class="chapter-item "><a href="../../ch08-00-common-collections.html"><strong aria-hidden="true">4.4.2.</strong> Common Collections</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch08-01-vectors.html"><strong aria-hidden="true">4.4.2.1.</strong> Vectors: Storing Lists of The Same Type of Values</a></li><li class="chapter-item "><a href="../../ch08-02-strings.html"><strong aria-hidden="true">4.4.2.2.</strong> Strings: Storing UTF-8 Encoded Text</a></li><li class="chapter-item "><a href="../../ch08-03-hash-maps.html"><strong aria-hidden="true">4.4.2.3.</strong> HasnMap&lt;K, V&gt;: Storing Keys with Associated Values</a></li></ol></li><li class="chapter-item "><a href="../../ch09-00-error-handling.html"><strong aria-hidden="true">4.4.3.</strong> Error Handling</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch09-01-unrecoverable-errors-with-panic.html"><strong aria-hidden="true">4.4.3.1.</strong> Unrecoverable Errors with panic!</a></li><li class="chapter-item "><a href="../../ch09-02-recoverable-errors-with-result.html"><strong aria-hidden="true">4.4.3.2.</strong> ⭐️Recoverable Errors with Result</a></li><li class="chapter-item "><a href="../../ch09-03-to-panic-or-not-to-panic.html"><strong aria-hidden="true">4.4.3.3.</strong> To panic! or Not to panic!</a></li></ol></li><li class="chapter-item "><a href="../../ch10-00-generics.html"><strong aria-hidden="true">4.4.4.</strong> Generic Types, Traits, and Lifetimes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch10-01-syntax.html"><strong aria-hidden="true">4.4.4.1.</strong> ✨Generic Data Types</a></li><li class="chapter-item "><a href="../../ch10-02-traits.html"><strong aria-hidden="true">4.4.4.2.</strong> 🪐Traits: Defining Shared Behavior</a></li><li class="chapter-item "><a href="../../ch10-03-lifetime-syntax.html"><strong aria-hidden="true">4.4.4.3.</strong> ⭐️Validating References with Lifetimes</a></li></ol></li><li class="chapter-item "><a href="../../ch11-00-testing.html"><strong aria-hidden="true">4.4.5.</strong> Writing Automated Tests</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch11-01-writing-tests.html"><strong aria-hidden="true">4.4.5.1.</strong> How to Write Tests</a></li><li class="chapter-item "><a href="../../ch11-02-running-tests.html"><strong aria-hidden="true">4.4.5.2.</strong> Controlling How Tests Are Run</a></li><li class="chapter-item "><a href="../../ch11-03-test-organization.html"><strong aria-hidden="true">4.4.5.3.</strong> Test Organization</a></li></ol></li><li class="chapter-item "><a href="../../ch12-00-an-io-project.html"><strong aria-hidden="true">4.4.6.</strong> An I/O Project: Building a Command Line Program</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch12-01-accepting-command-line-arguments.html"><strong aria-hidden="true">4.4.6.1.</strong> Accepting Command Line Arguments</a></li><li class="chapter-item "><a href="../../ch12-02-reading-a-file.html"><strong aria-hidden="true">4.4.6.2.</strong> Reading a File</a></li><li class="chapter-item "><a href="../../ch12-03-improving-error-handling-and-modularity.html"><strong aria-hidden="true">4.4.6.3.</strong> Refactoring to Improve Modularity and Error Handling</a></li><li class="chapter-item "><a href="../../ch12-04-testing-the-librarys-functionality.html"><strong aria-hidden="true">4.4.6.4.</strong> Developing the Library’s Functionality with Test Driven Development</a></li><li class="chapter-item "><a href="../../ch12-05-working-with-environment-variables.html"><strong aria-hidden="true">4.4.6.5.</strong> Working with Environment Variables</a></li><li class="chapter-item "><a href="../../ch12-06-writing-to-stderr-instead-of-stdout.html"><strong aria-hidden="true">4.4.6.6.</strong> Writing Error Messages to Standard Error Instead of Standard Output</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../thinking_in_rust.html"><strong aria-hidden="true">4.5.</strong> 🤔Thinking in Rust</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch13-00-functional-features.html"><strong aria-hidden="true">4.5.1.</strong> Functional Language Features: Iterators and Closures</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch13-01-closures.html"><strong aria-hidden="true">4.5.1.1.</strong> Closures: Anonymous Functions that Capture Their Environment</a></li><li class="chapter-item "><a href="../../ch13-02-iterators.html"><strong aria-hidden="true">4.5.1.2.</strong> Processing a Series of Items with Iterators</a></li><li class="chapter-item "><a href="../../ch13-03-improving-our-io-project.html"><strong aria-hidden="true">4.5.1.3.</strong> Improving Our I/O Project</a></li><li class="chapter-item "><a href="../../ch13-04-performance.html"><strong aria-hidden="true">4.5.1.4.</strong> Comparing Performance: Loops vs. Iterators</a></li></ol></li><li class="chapter-item "><a href="../../ch14-00-more-about-cargo.html"><strong aria-hidden="true">4.5.2.</strong> More about Cargo and Crates.io</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch14-01-release-profiles.html"><strong aria-hidden="true">4.5.2.1.</strong> Customizing Builds with Release Profiles</a></li><li class="chapter-item "><a href="../../ch14-02-publishing-to-crates-io.html"><strong aria-hidden="true">4.5.2.2.</strong> Publishing a Crate to Crates.io</a></li><li class="chapter-item "><a href="../../ch14-03-cargo-workspaces.html"><strong aria-hidden="true">4.5.2.3.</strong> Cargo Workspaces</a></li><li class="chapter-item "><a href="../../ch14-04-installing-binaries.html"><strong aria-hidden="true">4.5.2.4.</strong> Installing Binaries from Crates.io with cargo install</a></li><li class="chapter-item "><a href="../../ch14-05-extending-cargo.html"><strong aria-hidden="true">4.5.2.5.</strong> Extending Cargo with Custom Commands</a></li></ol></li><li class="chapter-item "><a href="../../ch15-00-smart-pointers.html"><strong aria-hidden="true">4.5.3.</strong> ✨Smart Pointers(2+3): (Deref、Drop) + (Box/heap、Rc、RefCell/Reference Cycle）</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../smart_pointers_deref_drop.html"><strong aria-hidden="true">4.5.3.1.</strong> Two Typical Traits: Deref & Drop</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch15-02-deref.html"><strong aria-hidden="true">4.5.3.1.1.</strong> Deref(* operator): Treating Smart Pointers Like Regular References with the Deref Trait</a></li><li class="chapter-item "><a href="../../ch15-03-drop.html"><strong aria-hidden="true">4.5.3.1.2.</strong> Drop: Running Code on Cleanup with the Drop Trait</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">4.5.3.2.</strong> Three main types</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch15-01-box.html"><strong aria-hidden="true">4.5.3.2.1.</strong> Heap: Using Box&lt;T&gt; to Point to Data on the Heap</a></li><li class="chapter-item "><a href="../../rc_refcell.html"><strong aria-hidden="true">4.5.3.2.2.</strong> References Tracking Pointer Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch15-04-rc.html"><strong aria-hidden="true">4.5.3.2.2.1.</strong> Rc&lt;T&gt;(Reference Counting): single-threaded scenarios, immutable references of multiple owners, the Reference Counted Smart Pointer</a></li><li class="chapter-item "><a href="../../ch15-05-interior-mutability.html"><strong aria-hidden="true">4.5.3.2.2.2.</strong> RefCell&lt;T&gt;(reference counting cell): single-threaded scenarios, runtime borrow checking, the Interior Mutability Pattern</a></li><li class="chapter-item "><a href="../../ch15-06-reference-cycles.html"><strong aria-hidden="true">4.5.3.2.2.3.</strong> 🌟Reference Cycles Can Leak Memory: Mainly from Incorrect Usage of Rc&lt;T&gt; and RefCell&lt;T&gt;</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../ch16-00-concurrency.html"><strong aria-hidden="true">4.5.4.</strong> Fearless Concurrency</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch16-01-threads.html"><strong aria-hidden="true">4.5.4.1.</strong> Using Threads to Run Code Simultaneously</a></li><li class="chapter-item "><a href="../../ch16-02-message-passing.html"><strong aria-hidden="true">4.5.4.2.</strong> Using Message Passing to Transfer Data Between Threads</a></li><li class="chapter-item "><a href="../../ch16-03-shared-state.html"><strong aria-hidden="true">4.5.4.3.</strong> Shared-State Concurrency</a></li><li class="chapter-item "><a href="../../ch16-04-extensible-concurrency-sync-and-send.html"><strong aria-hidden="true">4.5.4.4.</strong> Extensible Concurrency with the Sync and Send Traits</a></li></ol></li><li class="chapter-item "><a href="../../ch17-00-oop.html"><strong aria-hidden="true">4.5.5.</strong> Object Oriented Programming Features of Rust</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch17-01-what-is-oo.html"><strong aria-hidden="true">4.5.5.1.</strong> Characteristics of Object-Oriented Languages</a></li><li class="chapter-item "><a href="../../ch17-02-trait-objects.html"><strong aria-hidden="true">4.5.5.2.</strong> 🌛️Using Trait Objects That Allow for Values of Different Types</a></li><li class="chapter-item "><a href="../../ch17-03-oo-design-patterns.html"><strong aria-hidden="true">4.5.5.3.</strong> Implementing an Object-Oriented Design Pattern</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">4.6.</strong> Advanced Topics</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch18-00-patterns.html"><strong aria-hidden="true">4.6.1.</strong> Patterns and Matching</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch18-01-all-the-places-for-patterns.html"><strong aria-hidden="true">4.6.1.1.</strong> All the Places Patterns Can Be Used</a></li><li class="chapter-item "><a href="../../ch18-02-refutability.html"><strong aria-hidden="true">4.6.1.2.</strong> Refutability: Whether a Pattern Might Fail to Match</a></li><li class="chapter-item "><a href="../../ch18-03-pattern-syntax.html"><strong aria-hidden="true">4.6.1.3.</strong> ⭐️Pattern Syntax</a></li></ol></li><li class="chapter-item "><a href="../../ch19-00-advanced-features.html"><strong aria-hidden="true">4.6.2.</strong> Advanced Features</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch19-01-unsafe-rust.html"><strong aria-hidden="true">4.6.2.1.</strong> Unsafe Rust</a></li><li class="chapter-item "><a href="../../ch19-03-advanced-traits.html"><strong aria-hidden="true">4.6.2.2.</strong> ⭐️Advanced Traits</a></li><li class="chapter-item "><a href="../../ch19-04-advanced-types.html"><strong aria-hidden="true">4.6.2.3.</strong> ✨Advanced Types</a></li><li class="chapter-item "><a href="../../ch19-05-advanced-functions-and-closures.html"><strong aria-hidden="true">4.6.2.4.</strong> 📦Advanced Functions and Closures</a></li><li class="chapter-item "><a href="../../ch19-06-macros.html"><strong aria-hidden="true">4.6.2.5.</strong> Macros</a></li></ol></li><li class="chapter-item "><a href="../../ch20-00-final-project-a-web-server.html"><strong aria-hidden="true">4.6.3.</strong> Final Project: Building a Multithreaded Web Server</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ch20-01-single-threaded.html"><strong aria-hidden="true">4.6.3.1.</strong> Building a Single-Threaded Web Server</a></li><li class="chapter-item "><a href="../../ch20-02-multithreaded.html"><strong aria-hidden="true">4.6.3.2.</strong> Turning Our Single-Threaded Server into a Multithreaded Server</a></li><li class="chapter-item "><a href="../../ch20-03-graceful-shutdown-and-cleanup.html"><strong aria-hidden="true">4.6.3.3.</strong> Graceful Shutdown and Cleanup</a></li></ol></li><li class="chapter-item "><a href="../../appendix-00.html"><strong aria-hidden="true">4.6.4.</strong> Appendix</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../appendix-01-keywords.html"><strong aria-hidden="true">4.6.4.1.</strong> A - Keywords</a></li><li class="chapter-item "><a href="../../appendix-02-operators.html"><strong aria-hidden="true">4.6.4.2.</strong> B - Operators and Symbols</a></li><li class="chapter-item "><a href="../../appendix-03-derivable-traits.html"><strong aria-hidden="true">4.6.4.3.</strong> ✨️C - Derivable Traits</a></li><li class="chapter-item "><a href="../../appendix-04-useful-development-tools.html"><strong aria-hidden="true">4.6.4.4.</strong> D - Useful Development Tools</a></li><li class="chapter-item "><a href="../../appendix-05-editions.html"><strong aria-hidden="true">4.6.4.5.</strong> E - Editions</a></li><li class="chapter-item "><a href="../../appendix-06-translation.html"><strong aria-hidden="true">4.6.4.6.</strong> F - Translations of the Book</a></li><li class="chapter-item "><a href="../../appendix-07-nightly-rust.html"><strong aria-hidden="true">4.6.4.7.</strong> G - How Rust is Made and “Nightly Rust”</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../rust_by_example_src/index.html"><strong aria-hidden="true">5.</strong> Rust By Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/hello.html"><strong aria-hidden="true">5.1.</strong> Hello World</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/hello/comment.html"><strong aria-hidden="true">5.1.1.</strong> Comments</a></li><li class="chapter-item "><a href="../../rust_by_example_src/hello/print.html"><strong aria-hidden="true">5.1.2.</strong> Formatted print</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/hello/print/print_debug.html"><strong aria-hidden="true">5.1.2.1.</strong> Debug</a></li><li class="chapter-item "><a href="../../rust_by_example_src/hello/print/print_display.html"><strong aria-hidden="true">5.1.2.2.</strong> Display</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/hello/print/print_display/testcase_list.html"><strong aria-hidden="true">5.1.2.2.1.</strong> Testcase: List</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/hello/print/fmt.html"><strong aria-hidden="true">5.1.2.3.</strong> Formatting</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.2.</strong> Types: Primitives, custom Types, Bindings and Change/Define/Advanced Conversion</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/primitives.html"><strong aria-hidden="true">5.2.1.</strong> Primitives</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/primitives/literals.html"><strong aria-hidden="true">5.2.1.1.</strong> Literals and operators</a></li><li class="chapter-item "><a href="../../rust_by_example_src/primitives/tuples.html"><strong aria-hidden="true">5.2.1.2.</strong> Tuples: a collection of values of different types</a></li><li class="chapter-item "><a href="../../rust_by_example_src/primitives/array.html"><strong aria-hidden="true">5.2.1.3.</strong> Arrays and Slices: a collection of objects of the same type T</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/custom_types.html"><strong aria-hidden="true">5.2.2.</strong> Custom Types: struct and enum</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/structs.html"><strong aria-hidden="true">5.2.2.1.</strong> Structures: Tuple, C structs and Unit structs</a></li><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/enum.html"><strong aria-hidden="true">5.2.2.2.</strong> ✨Enums: and Type alias</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/enum/enum_use.html"><strong aria-hidden="true">5.2.2.2.1.</strong> use</a></li><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/enum/c_like.html"><strong aria-hidden="true">5.2.2.2.2.</strong> C-like</a></li><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/enum/testcase_linked_list.html"><strong aria-hidden="true">5.2.2.2.3.</strong> Testcase: linked-list</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/custom_types/constants.html"><strong aria-hidden="true">5.2.2.3.</strong> constants: const and static</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/variable_bindings.html"><strong aria-hidden="true">5.2.3.</strong> Variable Bindings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/variable_bindings/mut.html"><strong aria-hidden="true">5.2.3.1.</strong> Mutability</a></li><li class="chapter-item "><a href="../../rust_by_example_src/variable_bindings/scope.html"><strong aria-hidden="true">5.2.3.2.</strong> Scope ({}) and Shadowing</a></li><li class="chapter-item "><a href="../../rust_by_example_src/variable_bindings/declare.html"><strong aria-hidden="true">5.2.3.3.</strong> Declare first</a></li><li class="chapter-item "><a href="../../rust_by_example_src/variable_bindings/freeze.html"><strong aria-hidden="true">5.2.3.4.</strong> Freezing</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/types.html"><strong aria-hidden="true">5.2.4.</strong> 🚶Basic Conversion: Change or Define Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/types/cast.html"><strong aria-hidden="true">5.2.4.1.</strong> as: Casting using as keyword</a></li><li class="chapter-item "><a href="../../rust_by_example_src/types/literals.html"><strong aria-hidden="true">5.2.4.2.</strong> Literals</a></li><li class="chapter-item "><a href="../../rust_by_example_src/types/inference.html"><strong aria-hidden="true">5.2.4.3.</strong> Inference</a></li><li class="chapter-item "><a href="../../rust_by_example_src/types/alias.html"><strong aria-hidden="true">5.2.4.4.</strong> ✨Type Aliasing: give a new name to an existing type</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/conversion.html"><strong aria-hidden="true">5.2.5.</strong> 💃Advanced Conversion: From/Into trait</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/conversion/from_into.html"><strong aria-hidden="true">5.2.5.1.</strong> From and Into</a></li><li class="chapter-item "><a href="../../rust_by_example_src/conversion/try_from_try_into.html"><strong aria-hidden="true">5.2.5.2.</strong> TryFrom and TryInto: used for fallible conversions, return Result</a></li><li class="chapter-item "><a href="../../rust_by_example_src/conversion/string.html"><strong aria-hidden="true">5.2.5.3.</strong> ToString and FromStr trait: To and from Strings</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.3.</strong> Control: Statements, Functions and Error handling</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/expression.html"><strong aria-hidden="true">5.3.1.</strong> ✨Expressions: statements end with ;</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control.html"><strong aria-hidden="true">5.3.2.</strong> 🧮 Flow of Control</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/if_else.html"><strong aria-hidden="true">5.3.2.1.</strong> if/else</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/while.html"><strong aria-hidden="true">5.3.2.2.</strong> while</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/loop.html"><strong aria-hidden="true">5.3.2.3.</strong> loop</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/loop/nested.html"><strong aria-hidden="true">5.3.2.3.1.</strong> Nesting and labels: a little like lifetime annotations</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/loop/return.html"><strong aria-hidden="true">5.3.2.3.2.</strong> Returning from loops</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/if_let.html"><strong aria-hidden="true">5.3.2.4.</strong> if let</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/while_let.html"><strong aria-hidden="true">5.3.2.5.</strong> ✨while_let</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/for.html"><strong aria-hidden="true">5.3.2.6.</strong> for and range</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/match.html"><strong aria-hidden="true">5.3.2.7.</strong> ⭐️match</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/match/destructuring.html"><strong aria-hidden="true">5.3.2.7.1.</strong> ✨✨✨Destructuring</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/match/guard.html"><strong aria-hidden="true">5.3.2.7.2.</strong> Guards: to filter the arm</a></li><li class="chapter-item "><a href="../../rust_by_example_src/flow_control/match/binding.html"><strong aria-hidden="true">5.3.2.7.3.</strong> @ Binding</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/fn.html"><strong aria-hidden="true">5.3.3.</strong> ✨Functions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/fn/methods.html"><strong aria-hidden="true">5.3.3.1.</strong> Methods</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures.html"><strong aria-hidden="true">5.3.3.2.</strong> ✨Closures</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/capture.html"><strong aria-hidden="true">5.3.3.2.1.</strong> Capturing</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.3.3.2.2.</strong> Fn/FnMut/FnOnce</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/anonymity.html"><strong aria-hidden="true">5.3.3.2.2.1.</strong> Type anonymity</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/input_parameters.html"><strong aria-hidden="true">5.3.3.2.2.2.</strong> As input parameters</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/output_parameters.html"><strong aria-hidden="true">5.3.3.2.2.3.</strong> As output parameters</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/input_functions.html"><strong aria-hidden="true">5.3.3.2.2.4.</strong> Input functions</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/closure_examples.html"><strong aria-hidden="true">5.3.3.2.3.</strong> Examples in std</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/closure_examples/iter_any.html"><strong aria-hidden="true">5.3.3.2.3.1.</strong> Iterator::any</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/closures/closure_examples/iter_find.html"><strong aria-hidden="true">5.3.3.2.3.2.</strong> Searching through iterators</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/hof.html"><strong aria-hidden="true">5.3.3.3.</strong> Higher Order Functions</a></li><li class="chapter-item "><a href="../../rust_by_example_src/fn/diverging.html"><strong aria-hidden="true">5.3.3.4.</strong> ✨Diverging functions: return !, different from ()</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/error.html"><strong aria-hidden="true">5.3.4.</strong> ⭐️Error handling: Panic、Option and Result</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/panic.html"><strong aria-hidden="true">5.3.4.1.</strong> panic!: unrecoverable, try-exception</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/abort_unwind.html"><strong aria-hidden="true">5.3.4.1.1.</strong> ✨abort & unwind: Two implementation mechanisms of panic</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/error/option_unwrap.html"><strong aria-hidden="true">5.3.4.2.</strong> Option & unwrap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/option_unwrap/map.html"><strong aria-hidden="true">5.3.4.2.1.</strong> Combinators of Option: map</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/option_unwrap/and_then.html"><strong aria-hidden="true">5.3.4.2.2.</strong> Combinators of Option: and_then</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/option_unwrap/defaults.html"><strong aria-hidden="true">5.3.4.2.3.</strong> Defaults: or, or_else, get_or_insert, 'get_or_insert_with`</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/error/result.html"><strong aria-hidden="true">5.3.4.3.</strong> Result & OK or ?: A Richer Version Of Option</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/result/result_map.html"><strong aria-hidden="true">5.3.4.3.1.</strong> map for Result: catch explicit Exception and Continue</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/result/result_alias.html"><strong aria-hidden="true">5.3.4.3.2.</strong> Custom Exception: aliases for Result</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/result/early_returns.html"><strong aria-hidden="true">5.3.4.3.3.</strong> Early returns: Catch Exception and Return</a></li></ol></li><li class="chapter-item "><a href="../../#.html"><strong aria-hidden="true">5.3.4.4.</strong> ?: the uses of question mark</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/result/enter_question_mark.html"><strong aria-hidden="true">5.3.4.4.1.</strong> Introducing ?</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/option_unwrap/question_mark.html"><strong aria-hidden="true">5.3.4.4.2.</strong> Unpacking options with ? to return the Some or terminate</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types/reenter_question_mark.html"><strong aria-hidden="true">5.3.4.4.3.</strong> Other uses of ?</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types.html"><strong aria-hidden="true">5.3.4.5.</strong> Multiple error types to interact</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types/option_result.html"><strong aria-hidden="true">5.3.4.5.1.</strong> Pulling Results out of Options</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types/define_error_type.html"><strong aria-hidden="true">5.3.4.5.2.</strong> Defining an error type</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types/boxing_errors.html"><strong aria-hidden="true">5.3.4.5.3.</strong> Boxing errors</a></li><li class="chapter-item "><a href="../../rust_by_example_src/error/multiple_error_types/wrap_error.html"><strong aria-hidden="true">5.3.4.5.4.</strong> Wrapping errors</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/error/iter_result.html"><strong aria-hidden="true">5.3.4.6.</strong> Iterating over Results</a></li><li class="chapter-item "><a href="../../rust_by_example_src/encapsulation_modules_crates_cargo.html"><strong aria-hidden="true">5.3.4.7.</strong> 📒Error Handling Practices -- ChatGPT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/error/error_handling_practices/basic_practics.html"><strong aria-hidden="true">5.3.4.7.1.</strong> Basic Practices</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/encapsulation_modules_crates_cargo.html"><strong aria-hidden="true">5.4.</strong> Encapsulation: Modules, Crates and Cargo</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/mod.html"><strong aria-hidden="true">5.4.1.</strong> Modules: hierarchically split and manage visibility</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/mod/visibility.html"><strong aria-hidden="true">5.4.1.1.</strong> Visibility</a></li><li class="chapter-item "><a href="../../rust_by_example_src/mod/struct_visibility.html"><strong aria-hidden="true">5.4.1.2.</strong> Struct visibility: an extra level of visibility with their fields</a></li><li class="chapter-item "><a href="../../rust_by_example_src/mod/use.html"><strong aria-hidden="true">5.4.1.3.</strong> The use declaration: bind a full path to a new name</a></li><li class="chapter-item "><a href="../../rust_by_example_src/mod/super.html"><strong aria-hidden="true">5.4.1.4.</strong> super and self: remove ambiguity</a></li><li class="chapter-item "><a href="../../rust_by_example_src/mod/split.html"><strong aria-hidden="true">5.4.1.5.</strong> File/Directory hierarchy</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/crates.html"><strong aria-hidden="true">5.4.2.</strong> Crates: compilation units in Rust, library or binary</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/crates/lib.html"><strong aria-hidden="true">5.4.2.1.</strong> Creating a Library: --crate-type=lib</a></li><li class="chapter-item "><a href="../../rust_by_example_src/crates/using_lib.html"><strong aria-hidden="true">5.4.2.2.</strong> Using a Library: --extern</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/cargo.html"><strong aria-hidden="true">5.4.3.</strong> Cargo: package management tool</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/cargo/deps.html"><strong aria-hidden="true">5.4.3.1.</strong> Dependencies</a></li><li class="chapter-item "><a href="../../rust_by_example_src/cargo/conventions.html"><strong aria-hidden="true">5.4.3.2.</strong> Two Binaries Conventions</a></li><li class="chapter-item "><a href="../../rust_by_example_src/cargo/test.html"><strong aria-hidden="true">5.4.3.3.</strong> ✨Tests</a></li><li class="chapter-item "><a href="../../rust_by_example_src/cargo/build_scripts.html"><strong aria-hidden="true">5.4.3.4.</strong> Build Scripts</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.5.</strong> Rust Core: Generics, Traits and Scoping</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics.html"><strong aria-hidden="true">5.5.1.</strong> 🪐Generics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/used_as_parameter.html"><strong aria-hidden="true">5.5.1.1.</strong> Used as Parameter</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/gen_fn.html"><strong aria-hidden="true">5.5.1.1.1.</strong> Functions: Identify whether a generic function</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/impl.html"><strong aria-hidden="true">5.5.1.1.2.</strong> Impl Type fn: Identify whether a generic method</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/gen_trait.html"><strong aria-hidden="true">5.5.1.1.3.</strong> Impl Traits fn: Identify whether a generic method</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/trait_bounds.html"><strong aria-hidden="true">5.5.1.2.</strong> Bounded by Trait</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/bounds/testcase_empty.html"><strong aria-hidden="true">5.5.1.2.1.</strong> ✨Testcase: empty bounds</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/bounds/multi_trait_bounds.html"><strong aria-hidden="true">5.5.1.2.2.</strong> Multiple Trait Bounds</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/bounds/where_bounds.html"><strong aria-hidden="true">5.5.1.2.3.</strong> Where clauses bounds</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/new_types.html"><strong aria-hidden="true">5.5.1.3.</strong> New Type Idiom</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/assoc_items.html"><strong aria-hidden="true">5.5.1.4.</strong> ✨Associated items</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/assoc_items/the_problem.html"><strong aria-hidden="true">5.5.1.4.1.</strong> ✨The Problem</a></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/assoc_items/types.html"><strong aria-hidden="true">5.5.1.4.2.</strong> Associated types</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/generics/phantom.html"><strong aria-hidden="true">5.5.1.5.</strong> Phantom type parameters</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/generics/phantom/testcase_units.html"><strong aria-hidden="true">5.5.1.5.1.</strong> Testcase: unit clarification</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/trait.html"><strong aria-hidden="true">5.5.2.</strong> 🪐Traits</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/trait/derive.html"><strong aria-hidden="true">5.5.2.1.</strong> ✨Derive Macro Traits</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/dyn.html"><strong aria-hidden="true">5.5.2.2.</strong> Returning Traits with dyn</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/ops.html"><strong aria-hidden="true">5.5.2.3.</strong> Operator Overloading</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/drop.html"><strong aria-hidden="true">5.5.2.4.</strong> Drop</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/iter.html"><strong aria-hidden="true">5.5.2.5.</strong> Iterators: Iterator Trait</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/impl_trait.html"><strong aria-hidden="true">5.5.2.6.</strong> ✨impl Trait</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/supertraits.html"><strong aria-hidden="true">5.5.2.7.</strong> Supertraits</a></li><li class="chapter-item "><a href="../../rust_by_example_src/trait/disambiguating.html"><strong aria-hidden="true">5.5.2.8.</strong> Fully Qualified Syntax: Disambiguating overlapping traits</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/scope.html"><strong aria-hidden="true">5.5.3.</strong> 🪐Scoping rules</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/scope/raii.html"><strong aria-hidden="true">5.5.3.1.</strong> RAII</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/move.html"><strong aria-hidden="true">5.5.3.2.</strong> Ownership and moves</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/scope/move/mut.html"><strong aria-hidden="true">5.5.3.2.1.</strong> Mutability</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/move/partial_move.html"><strong aria-hidden="true">5.5.3.2.2.</strong> Partial moves</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/borrow.html"><strong aria-hidden="true">5.5.3.3.</strong> Borrowing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/scope/borrow/mut.html"><strong aria-hidden="true">5.5.3.3.1.</strong> Mutability</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/borrow/alias.html"><strong aria-hidden="true">5.5.3.3.2.</strong> Mutable or Immutable, Only One</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/borrow/ref.html"><strong aria-hidden="true">5.5.3.3.3.</strong> ✨The ref pattern</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime.html"><strong aria-hidden="true">5.5.3.4.</strong> Lifetimes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/elision.html"><strong aria-hidden="true">5.5.3.4.1.</strong> Elision</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/explicit.html"><strong aria-hidden="true">5.5.3.4.2.</strong> ✨Explicit lifetime annotation: another Generic</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/fn_method_struct_trait.html"><strong aria-hidden="true">5.5.3.4.3.</strong> ✨Functions、methods、struct、trait</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/lifetime_bounds.html"><strong aria-hidden="true">5.5.3.4.4.</strong> Lifetime Bounds for generics</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/lifetime_coercion.html"><strong aria-hidden="true">5.5.3.4.5.</strong> Coercion</a></li><li class="chapter-item "><a href="../../rust_by_example_src/scope/lifetime/static_lifetime.html"><strong aria-hidden="true">5.5.3.4.6.</strong> Static</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.6.</strong> Macros: rules! and Attributes</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/macros.html"><strong aria-hidden="true">5.6.1.</strong> macro_rules!</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/macros/syntax.html"><strong aria-hidden="true">5.6.1.1.</strong> Syntax</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/macros/designators.html"><strong aria-hidden="true">5.6.1.1.1.</strong> Designators</a></li><li class="chapter-item "><a href="../../rust_by_example_src/macros/overload.html"><strong aria-hidden="true">5.6.1.1.2.</strong> Overload</a></li><li class="chapter-item "><a href="../../rust_by_example_src/macros/repeat.html"><strong aria-hidden="true">5.6.1.1.3.</strong> Repeat</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/macros/dry.html"><strong aria-hidden="true">5.6.1.2.</strong> DRY (rust_by_example_src/Don't Repeat Yourself)</a></li><li class="chapter-item "><a href="../../rust_by_example_src/macros/dsl.html"><strong aria-hidden="true">5.6.1.3.</strong> DSL (rust_by_example_src/Domain Specific Languages)</a></li><li class="chapter-item "><a href="../../rust_by_example_src/macros/variadics.html"><strong aria-hidden="true">5.6.1.4.</strong> Variadics</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/attribute.html"><strong aria-hidden="true">5.6.2.</strong> 🧐 Attributes: metadata applied to some module, crate or item</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/attribute/unused.html"><strong aria-hidden="true">5.6.2.1.</strong> dead_code: disable the unused lint</a></li><li class="chapter-item "><a href="../../rust_by_example_src/attribute/crate.html"><strong aria-hidden="true">5.6.2.2.</strong> Crates: : crate_type and crate_name</a></li><li class="chapter-item "><a href="../../rust_by_example_src/attribute/cfg.html"><strong aria-hidden="true">5.6.2.3.</strong> cfg: Configuration conditional checks</a></li><li class="chapter-item "><a href="../../rust_by_example_src/attribute/cfg/custom.html"><strong aria-hidden="true">5.6.2.4.</strong> Custom: Custom conditionals</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.7.</strong> Std: Library types and Misc</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std.html"><strong aria-hidden="true">5.7.1.</strong> ⭐️Std library types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std/box.html"><strong aria-hidden="true">5.7.1.1.</strong> ✨Box, stack and heap</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/vec.html"><strong aria-hidden="true">5.7.1.2.</strong> ✨Vectors: re-sizable arrays</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/str.html"><strong aria-hidden="true">5.7.1.3.</strong> ✨Strings: String and &str</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/panic.html"><strong aria-hidden="true">5.7.1.4.</strong> panic!: Raise Exception , no Catch</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/option.html"><strong aria-hidden="true">5.7.1.5.</strong> Option: catching failure instead of calling panic!</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/result.html"><strong aria-hidden="true">5.7.1.6.</strong> Result: express why an operation failed</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/result/question_mark.html"><strong aria-hidden="true">5.7.1.7.</strong> ?: Chaining Results only match Ok(ok)</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/hash.html"><strong aria-hidden="true">5.7.1.8.</strong> HashMap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std/hash/alt_key_types.html"><strong aria-hidden="true">5.7.1.8.1.</strong> Alternate/custom key types</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/hash/hashset.html"><strong aria-hidden="true">5.7.1.8.2.</strong> HashSet</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/std/rc.html"><strong aria-hidden="true">5.7.1.9.</strong> Rc: for mutiple ownership, just like what python have done</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std/arc.html"><strong aria-hidden="true">5.7.1.10.</strong> Arc: shared ownership between threads</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc.html"><strong aria-hidden="true">5.7.2.</strong> 🌌 Std misc</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/threads.html"><strong aria-hidden="true">5.7.2.1.</strong> Threads</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/threads/testcase_mapreduce.html"><strong aria-hidden="true">5.7.2.2.</strong> ✨Testcase: map-reduce</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/channels.html"><strong aria-hidden="true">5.7.2.3.</strong> Channels: Asynchronous communication between threads</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/path.html"><strong aria-hidden="true">5.7.2.4.</strong> Path</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/file.html"><strong aria-hidden="true">5.7.2.5.</strong> File I/O</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/file/open.html"><strong aria-hidden="true">5.7.2.5.1.</strong> open: read-only</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/file/create.html"><strong aria-hidden="true">5.7.2.5.2.</strong> create: write-only</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/file/read_lines.html"><strong aria-hidden="true">5.7.2.5.3.</strong> read lines: returns an iterator</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/process.html"><strong aria-hidden="true">5.7.2.6.</strong> Child processes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/process/pipe.html"><strong aria-hidden="true">5.7.2.6.1.</strong> Pipes: interaction with the underlying process</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/process/wait.html"><strong aria-hidden="true">5.7.2.6.2.</strong> Wait</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/fs.html"><strong aria-hidden="true">5.7.2.7.</strong> std::fs: Filesystem Operations</a></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/arg.html"><strong aria-hidden="true">5.7.2.8.</strong> Program arguments</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/arg/matching.html"><strong aria-hidden="true">5.7.2.8.1.</strong> Match to Argument parsing</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/std_misc/ffi.html"><strong aria-hidden="true">5.7.2.9.</strong> FFI: Foreign Function Interface</a></li></ol></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">5.8.</strong> Misc: Testing, Unsafe, Compatibility and Meta</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/testing.html"><strong aria-hidden="true">5.8.1.</strong> Testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/testing/unit_testing.html"><strong aria-hidden="true">5.8.1.1.</strong> ✨Unit testing for panic: #[cfg(test)], #[test], #[should_panic], #[ignore]</a></li><li class="chapter-item "><a href="../../rust_by_example_src/meta/doc.html"><strong aria-hidden="true">5.8.1.2.</strong> Documentation: cargo doc</a></li><li class="chapter-item "><a href="../../rust_by_example_src/testing/doc_testing.html"><strong aria-hidden="true">5.8.1.3.</strong> ⭐️Documentation testing</a></li><li class="chapter-item "><a href="../../rust_by_example_src/testing/integration_testing.html"><strong aria-hidden="true">5.8.1.4.</strong> Integration testing</a></li><li class="chapter-item "><a href="../../rust_by_example_src/testing/dev_dependencies.html"><strong aria-hidden="true">5.8.1.5.</strong> Dev-dependencies</a></li></ol></li><li class="chapter-item "><a href="../../rust_by_example_src/unsafe.html"><strong aria-hidden="true">5.8.2.</strong> Unsafe Operations</a></li><li class="chapter-item "><a href="../../rust_by_example_src/unsafe/asm.html"><strong aria-hidden="true">5.8.3.</strong> 🤔️asm!: Inline assembly in Unsafe</a></li><li class="chapter-item "><a href="../../rust_by_example_src/compatibility.html"><strong aria-hidden="true">5.8.4.</strong> Compatibility</a></li><li class="chapter-item "><a href="../../rust_by_example_src/compatibility/raw_identifiers.html"><strong aria-hidden="true">5.8.5.</strong> Raw identifiers: r#</a></li><li class="chapter-item "><a href="../../rust_by_example_src/meta.html"><strong aria-hidden="true">5.8.6.</strong> Meta</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../rust_by_example_src/meta/playground.html"><strong aria-hidden="true">5.8.6.1.</strong> Playground</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../PyO3_guides/src/index.html"><strong aria-hidden="true">6.</strong> The PyO3 Guide</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/getting_started.html"><strong aria-hidden="true">6.1.</strong> Getting started</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/module.html"><strong aria-hidden="true">6.2.</strong> Python modules</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/function.html"><strong aria-hidden="true">6.3.</strong> Python functions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/function/signature.html"><strong aria-hidden="true">6.3.1.</strong> Function signatures</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/function/error_handling.html"><strong aria-hidden="true">6.3.2.</strong> Error handling</a></li></ol></li><li class="chapter-item "><a href="../../PyO3_guides/src/class.html"><strong aria-hidden="true">6.4.</strong> Python classes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/class/protocols.html"><strong aria-hidden="true">6.4.1.</strong> Class customizations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/class/object.html"><strong aria-hidden="true">6.4.1.1.</strong> Basic object customization</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/class/numeric.html"><strong aria-hidden="true">6.4.1.2.</strong> Emulating numeric types</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/class/call.html"><strong aria-hidden="true">6.4.1.3.</strong> Emulating callable objects</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../PyO3_guides/src/conversions.html"><strong aria-hidden="true">6.5.</strong> Type conversions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/conversions/tables.html"><strong aria-hidden="true">6.5.1.</strong> Mapping of Rust types to Python types</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/conversions/traits.html"><strong aria-hidden="true">6.5.2.</strong> Conversion traits</a></li></ol></li><li class="chapter-item "><a href="../../PyO3_guides/src/exception.html"><strong aria-hidden="true">6.6.</strong> Python exceptions</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/python_from_rust.html"><strong aria-hidden="true">6.7.</strong> Calling Python from Rust</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/types.html"><strong aria-hidden="true">6.8.</strong> GIL, mutability and object types</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/parallelism.html"><strong aria-hidden="true">6.9.</strong> Parallelism</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/debugging.html"><strong aria-hidden="true">6.10.</strong> Debugging</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/features.html"><strong aria-hidden="true">6.11.</strong> Features reference</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/memory.html"><strong aria-hidden="true">6.12.</strong> Memory management</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/advanced.html"><strong aria-hidden="true">6.13.</strong> Advanced topics</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/building_and_distribution.html"><strong aria-hidden="true">6.14.</strong> ⭐️Building and distribution</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/building_and_distribution/multiple_python_versions.html"><strong aria-hidden="true">6.14.1.</strong> Supporting multiple Python versions</a></li></ol></li><li class="chapter-item "><a href="../../PyO3_guides/src/ecosystem.html"><strong aria-hidden="true">6.15.</strong> Useful crates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PyO3_guides/src/ecosystem/logging.html"><strong aria-hidden="true">6.15.1.</strong> Logging</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/ecosystem/async-await.html"><strong aria-hidden="true">6.15.2.</strong> Using async and await</a></li></ol></li><li class="chapter-item "><a href="../../PyO3_guides/src/faq.html"><strong aria-hidden="true">6.16.</strong> FAQ and troubleshooting</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/migration.html"><strong aria-hidden="true">6.17.</strong> Appendix A: Migration guide</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/rust_cpython.html"><strong aria-hidden="true">6.18.</strong> Appendix B: PyO3 and rust-cpython</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/trait_bounds.html"><strong aria-hidden="true">6.19.</strong> Appendix C: Trait bounds</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/python_typing_hints.html"><strong aria-hidden="true">6.20.</strong> Appendix D: Python typing hints</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/changelog.html"><strong aria-hidden="true">6.21.</strong> CHANGELOG</a></li><li class="chapter-item "><a href="../../PyO3_guides/src/contributing.html"><strong aria-hidden="true">6.22.</strong> Contributing</a></li></ol></li><li class="chapter-item expanded "><a href="../../checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">The Rust Programming Language</h1>
            <h4 class="menu-bar">日不见增 月有渐进 | 唯剃真我 方有成效｜ 惊涛拍案 千层雪起 | <a href="https://kuanhsiaokuo.github.io/think-tool-kit/">保持批判，有所取舍 | 知行合一, 方见真我</a> | 练武不练功
                到头一场空 -- 《赛博英雄传》 </h4>
            <div class="right-buttons">
                    <a href="../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="atomics-and-memory-ordering"><a class="header" href="#atomics-and-memory-ordering">Atomics and Memory Ordering</a></h1>
<!--ts-->
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Wed Apr 19 08:50:47 UTC 2023 -->
<!--te-->
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Section Overview: In this video, the speaker will explain atomics and memory ordering. The speaker has been hesitant to tackle this topic because of the lack of documentation and complexity of the subject. However, after working with it enough, he feels confident in giving a correct and understandable explanation.</p>
<h3 id="why-do-we-need-atomics"><a class="header" href="#why-do-we-need-atomics">Why Do We Need Atomics?</a></h3>
<ul>
<li>If you have a primitive type like bool or usize that is shared across thread boundaries, there are only certain ways to interact with that value that are safe.</li>
<li>It makes sense to have slightly different APIs for atomic types because you’re issuing different instructions to the underlying CPU and placing different limitations on what code the compiler is allowed to generate.</li>
<li>When you have shared access to some memory value, you need additional information about that access to let the CPU know when should different threads see the operations that other threads do.</li>
<li>Rust’s standard sync atomic model has good documentation on high-level ideas of why we have these types and what they’re used for.</li>
</ul>
<h3 id="what-will-be-covered"><a class="header" href="#what-will-be-covered">What Will Be Covered?</a></h3>
<ul>
<li>The stream will be Rust-specific but most of it translates to any other language that has atomics in this kind of sense.</li>
<li>The core focus will be on Rust’s atomic types and memory ordering observed in Rust.</li>
</ul>
<h2 id="atomic-types"><a class="header" href="#atomic-types">Atomic Types</a></h2>
<p>Section Overview: This section explains why using primitive types like bool or usize can lead to undefined behavior when shared across thread boundaries. It also explains how atomic types provide additional information about shared access to memory values.</p>
<h3 id="why-not-use-primitive-types"><a class="header" href="#why-not-use-primitive-types">Why Not Use Primitive Types?</a></h3>
<ul>
<li>There are only certain ways to interact with primitive types safely when they are shared across thread boundaries.</li>
<li>Data races are undefined behavior, so if you don’t control how different threads interoperate on the same memory location, you run into undefined behavior.</li>
<li>Atomic types provide additional information about shared access to memory values.</li>
</ul>
<h3 id="what-are-atomic-types"><a class="header" href="#what-are-atomic-types">What Are Atomic Types?</a></h3>
<ul>
<li>When operating on atomic versions of primitive types, you’re issuing different instructions to the underlying CPU and placing different limitations on what code the compiler is allowed to generate.</li>
<li>You need additional information about shared access to memory values to let the CPU know when should different threads see the operations that other threads do.</li>
</ul>
<h3 id="why-do-we-need-different-apis-for-atomic-types"><a class="header" href="#why-do-we-need-different-apis-for-atomic-types">Why Do We Need Different APIs for Atomic Types?</a></h3>
<ul>
<li>It makes sense to have slightly different APIs for atomic types because they place different limitations on what code the compiler is allowed to generate.</li>
</ul>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>Section Overview: The speaker concludes by summarizing why atomics are necessary and what will be covered in this video. He also emphasizes that understanding memory ordering is useful regardless of what language you’re working in.</p>
<h3 id="key-takeaways"><a class="header" href="#key-takeaways">Key Takeaways</a></h3>
<ul>
<li>If you have a primitive type like bool or usize that is shared across thread boundaries, there are only certain ways to interact with that value that are safe.</li>
<li>Rust’s standard sync atomic model has good documentation on high-level ideas of why we have these types and what they’re used for.</li>
<li>Understanding memory ordering is useful regardless of what language you’re working in.</li>
</ul>
<h2 id="rust-memory-model"><a class="header" href="#rust-memory-model">Rust Memory Model</a></h2>
<p>Section Overview: In this section, the speaker talks about the Rust memory model and how it is not yet fully defined. They also introduce the Rust reference as a source of information for implementing a Rust compiler.</p>
<h3 id="introduction-to-memory-model"><a class="header" href="#introduction-to-memory-model">Introduction to Memory Model</a></h3>
<ul>
<li>The Rust language does not have a fully defined memory model yet.</li>
<li>Various proposals are being worked on by academics and industry professionals.</li>
<li>This can be unhelpful when writing code that uses atomics and concurrency.</li>
</ul>
<h3 id="memory-ordering-documentation"><a class="header" href="#memory-ordering-documentation">Memory Ordering Documentation</a></h3>
<ul>
<li>The speaker will be using the memory ordering documentation from C++ as it has good explanations and examples of different memory orderings.</li>
<li>This page will be used for explanations, examples, and guarantees throughout the talk.</li>
</ul>
<h3 id="atomic-types-in-rust"><a class="header" href="#atomic-types-in-rust">Atomic Types in Rust</a></h3>
<ul>
<li>Atomic types in Rust are not inherently shared and need to be placed on the heap using something like <code>Box</code> or <code>Arc</code>.</li>
<li>This allows sharing a pointer or reference to that atomic value which can then be updated.</li>
<li>The main differentiator between atomic types and regular types is that atomic types can be operated on using shared references to self.</li>
</ul>
<h3 id="methods-for-atomic-use-size-type"><a class="header" href="#methods-for-atomic-use-size-type">Methods for Atomic Use Size Type</a></h3>
<ul>
<li>There are several methods available for operating on an atomic use size type, including load, store, swap, compare_and_swap, fetch_add/sub/and/or/xor/nand.</li>
<li>Load returns the value stored in the atomic use size type while store takes a value and stores it into the type.</li>
<li>Swap performs both operations at once by returning the old value while storing a new one.</li>
<li>Compare_and_swap compares the current value with an expected value and if they match, replaces it with a new one. Otherwise, it returns the current value without modifying it.</li>
<li>Fetch_add/sub/and/or/xor/nand performs the corresponding operation on the value stored in the atomic use size type and returns the old value.</li>
</ul>
<h2 id="introduction-to-memory-ordering"><a class="header" href="#introduction-to-memory-ordering">Introduction to Memory Ordering</a></h2>
<p>Section Overview: In this section, the speaker introduces memory ordering and its importance in multi-threaded programming. They also introduce some methods for reading and swapping values atomically.</p>
<h3 id="memory-ordering-and-guarantees"><a class="header" href="#memory-ordering-and-guarantees">Memory Ordering and Guarantees</a></h3>
<ul>
<li>Memory ordering tells the compiler which set of guarantees you expect for a particular memory access with respect to things that might be happening in other threads at the same time.</li>
<li>There are different types of guarantees provided by memory ordering, such as acquire, release, and sequentially consistent.</li>
</ul>
<h3 id="atomic-operations"><a class="header" href="#atomic-operations">Atomic Operations</a></h3>
<ul>
<li>Atomic operations allow multiple threads to operate on a value at the same time in a well-defined way without locking.</li>
<li>Compare-and-swap is an atomic operation that reads a value and swaps it out conditionally in one atomic step. It ensures no thread can get between the load and store operations.</li>
<li>Fetch methods like fetch-add or fetch-sub are similar to compare-and-swap but perform arithmetic operations instead of conditional swaps. They also ensure no thread can execute between load and store operations.</li>
</ul>
<h3 id="questions-from-viewers"><a class="header" href="#questions-from-viewers">Questions from Viewers</a></h3>
<ul>
<li>Non-exhaustive means that no code is allowed to assume that these are all the variants that will ever be in ordering so if you match on an ordering, you always need to include an underscore branch in an otherwise or else branch because the standard library wants to be able to add additional orderings later if necessary.</li>
<li>The different orderings are related to what guarantees the operation gives you; how different architectures implement those guarantees will vary from architecture to architecture as we’ll see later on.</li>
<li>Mutex guards a larger section of code while atomic guards just a single memory access if needed but more efficiently than mutexes would.</li>
</ul>
<h2 id="understanding-atomic-types-in-rust"><a class="header" href="#understanding-atomic-types-in-rust"><a href="t=0:16:28">#</a> Understanding Atomic Types in Rust</a></h2>
<p>Section Overview: In this section, the speaker explains how atomic types work in Rust and why they are considered lock-free.</p>
<h3 id="atomic-operations-and-compiler-semantics"><a class="header" href="#atomic-operations-and-compiler-semantics">Atomic Operations and Compiler Semantics</a></h3>
<ul>
<li><a href="t=0:16:28"></a> Atomic types in Rust are considered lock-free because they do not use mutexes.</li>
<li><a href="t=0:16:51"></a> Atomic operations limit both what the CPU can do and what the compiler can do about a given memory access.</li>
<li><a href="t=0:17:08"></a> Even on architectures like Intel x86 64, it is still recommended to use atomic types because they provide guarantees from the compiler as well.</li>
</ul>
<h3 id="unsafe-cell-and-atomic-instructions"><a class="header" href="#unsafe-cell-and-atomic-instructions">Unsafe Cell and Atomic Instructions</a></h3>
<ul>
<li><a href="t=0:17:45"></a> The store swap and friends all take an immutable reference to self, which means they rely on unsafe cell.</li>
<li><a href="t=0:18:09"></a> All of these atomic instructions contain an unsafe cell that they then call get on to get the pointer to the value.</li>
<li><a href="t=0:18:30"></a> The atomic type macro expands to a struct definition that holds an unsafe cell of the inner type.</li>
</ul>
<h2 id="sharing-atomics-with-arc"><a class="header" href="#sharing-atomics-with-arc"><a href="t=0:19:07">#</a> Sharing Atomics with Arc</a></h2>
<p>Section Overview: In this section, the speaker discusses why atomics are generally shared via Arc rather than Box.</p>
<h3 id="using-arc-for-static-lifetime"><a class="header" href="#using-arc-for-static-lifetime">Using Arc for Static Lifetime</a></h3>
<ul>
<li><a href="t=0:19:27"></a> When spawning two threads, both require that the closure you pass in has a static lifetime.</li>
<li><a href="t=0:19:49"></a> With an Arc, you can clone it and give each thread its own individually owned and therefore static Arc to the atomic usize.</li>
</ul>
<h3 id="alternative-approach-with-box-leak"><a class="header" href="#alternative-approach-with-box-leak">Alternative Approach with Box Leak</a></h3>
<ul>
<li><a href="t=0:20.08s"></a> Box leak will leak a value on the heap so it will never call the destructor which gives you back a static reference which you can then pass to both threads.</li>
</ul>
<h2 id="implementing-a-mutex-type"><a class="header" href="#implementing-a-mutex-type"><a href="t=0:20:23">#</a> Implementing a Mutex Type</a></h2>
<p>Section Overview: In this section, the speaker demonstrates how to implement a mutex type using atomic types in Rust.</p>
<h3 id="defining-a-mutex-type"><a class="header" href="#defining-a-mutex-type">Defining a Mutex Type</a></h3>
<ul>
<li><a href="t=0:21:13"></a> A mutex is a combination of a boolean that marks whether or not someone currently holds the lock and then an unsafe cell to the inner type.</li>
<li><a href="t=0:21:43"></a> The implementation requires Sync Atomic and Atomic Bool.</li>
</ul>
<h3 id="using-with-lock-function"><a class="header" href="#using-with-lock-function">Using with Lock Function</a></h3>
<ul>
<li><a href="t=0:22:06"></a> The with_lock function takes an impul f and once that’s given immutable value to t returns r.</li>
</ul>
<h2 id="introduction-to-mutexes"><a class="header" href="#introduction-to-mutexes">Introduction to Mutexes</a></h2>
<p>Section Overview: In this section, the speaker introduces mutexes and explains why spin locks should not be used.</p>
<h3 id="naive-implementation-of-mutex"><a class="header" href="#naive-implementation-of-mutex">Naive Implementation of Mutex</a></h3>
<ul>
<li>The speaker creates a new method for the mutex.</li>
<li>The method takes an initial value to create the mutex with.</li>
<li>Constants are created to make the code more readable.</li>
<li>The speaker explains how the naive implementation of mutex works using a while loop that spins until the lock is no longer held.</li>
<li>The function captures return value, sets it back to unlocked, and returns red.</li>
</ul>
<h3 id="problems-with-naive-implementation"><a class="header" href="#problems-with-naive-implementation">Problems with Naive Implementation</a></h3>
<ul>
<li>The code does not compile because an argument is missing in the method.</li>
<li>Ordering is required in this method but it’s not clear what ordering should be used yet. For now, relaxed ordering will be used.</li>
</ul>
<h3 id="testing-mutex"><a class="header" href="#testing-mutex">Testing Mutex</a></h3>
<ul>
<li>A lock mutex is created and five threads are spawned to modify its value at the same time through the lock.</li>
<li>Each thread uses l.with_lock() and adds 1 to v a hundred times.</li>
</ul>
<h2 id="implementing-a-mutex"><a class="header" href="#implementing-a-mutex">Implementing a Mutex</a></h2>
<p>Section Overview: In this section, the speaker explains how to implement a mutex in Rust using atomics and compare-and-swap operations.</p>
<h3 id="collecting-thread-handles"><a class="header" href="#collecting-thread-handles">Collecting Thread Handles</a></h3>
<ul>
<li>We collect all thread handles so that we can wait for them afterwards.</li>
<li>We spin up 10 threads, each of which increments the value 100 times.</li>
</ul>
<h3 id="sync-for-mutex"><a class="header" href="#sync-for-mutex">Sync for Mutex</a></h3>
<ul>
<li>Unsafe cell cannot be shared between threads safely.</li>
<li>Mutex is sync for mutex t where t is send.</li>
<li>We implement sync from mutex so that you can concurrently access it from multiple threads as long as the value t is send.</li>
</ul>
<h3 id="problems-with-mutex-implementation"><a class="header" href="#problems-with-mutex-implementation">Problems with Mutex Implementation</a></h3>
<ul>
<li>The reason we need atomics and why we need operations like compare and swap is because here we’re doing a load and then we’re doing a store but in between here maybe another thread runs.</li>
<li>It’s possible for two threads to execute the closure passed to with lock at the same time, leading to undefined behavior.</li>
</ul>
<h2 id="understanding-concurrency-issues"><a class="header" href="#understanding-concurrency-issues">Understanding Concurrency Issues</a></h2>
<p>Section Overview: This section discusses the issues that arise when multiple threads are running concurrently and accessing shared memory.</p>
<h3 id="concurrency-issues-with-multiple-cores"><a class="header" href="#concurrency-issues-with-multiple-cores">Concurrency Issues with Multiple Cores</a></h3>
<ul>
<li>When different threads run on different cores, there is no control over the relative operations of each thread.</li>
<li>The operating system limits how long a given thread gets to run for and may forcibly stop a program in the middle to ensure all threads get to run.</li>
</ul>
<h3 id="race-conditions-and-preemption"><a class="header" href="#race-conditions-and-preemption">Race Conditions and Preemption</a></h3>
<ul>
<li>Preemption can occur at any point in time, including between a load and store operation.</li>
<li>A race condition occurs when two threads observe the mutex being unlocked at the same time.</li>
</ul>
<h3 id="solving-concurrency-issues-with-compare-exchange-operation"><a class="header" href="#solving-concurrency-issues-with-compare-exchange-operation">Solving Concurrency Issues with Compare Exchange Operation</a></h3>
<ul>
<li>The compare exchange operation is used to avoid race conditions between multiple threads accessing shared memory.</li>
<li>Compare exchange is more powerful than compare and swap because it strictly avoids race conditions.</li>
</ul>
<h2 id="overview-of-compare-exchange"><a class="header" href="#overview-of-compare-exchange">Overview of Compare Exchange</a></h2>
<p>Section Overview: In this section, the speaker explains how compare exchange works and why it is useful.</p>
<h3 id="how-compare-exchange-works"><a class="header" href="#how-compare-exchange-works">How Compare Exchange Works</a></h3>
<ul>
<li><code>compare_exchange</code> takes the current value, new value, and two orderings.</li>
<li>The first line of documentation stores a value into the atomic integer or boolean if the current value is the same as the current value.</li>
<li>If the CPU looks at the atomic bool and sees that it is unlocked (false), then it sets it to true in such a way that no other thread gets to modify the value in between when we look at it and when we change it.</li>
<li>Compare exchange is a single operation that is both read and write.</li>
<li>It can be done in a loop because if the current value is locked, then compare exchange will return an error.</li>
</ul>
<h3 id="why-compare-exchange-is-useful"><a class="header" href="#why-compare-exchange-is-useful">Why Compare Exchange Is Useful</a></h3>
<ul>
<li>Compare exchange solves this particular problem because there’s no space in between load and store; they’re just one operation performed on memory location.</li>
<li>However, compare exchange can be expensive because every CPU spins during compare exchange.</li>
<li>CPUs need to coordinate exclusive access amongst all these cores which can be inefficient.</li>
</ul>
<h2 id="compare-exchange-and-spin-locks"><a class="header" href="#compare-exchange-and-spin-locks">Compare Exchange and Spin Locks</a></h2>
<p>Section Overview: This section discusses the differences between compare exchange and spin locks, and how to optimize spin locks for high contention.</p>
<h3 id="compare-exchange-vs-spin-locks"><a class="header" href="#compare-exchange-vs-spin-locks">Compare Exchange vs. Spin Locks</a></h3>
<ul>
<li>In compare exchange, the CPU requires exclusive access to a location in memory, which requires coordination with everyone else.</li>
<li>A given location of memory can be marked as shared, allowing multiple cores to have a value in the shared state at the same time.</li>
<li>Compare exchange is much faster than locking a mutex because it will never wait. A single compare exchange call will try to do the operation you told it and then say either “I succeeded” or “I failed”. If it fails, it does not block the thread.</li>
<li>The biggest difference between compare exchange and a mutex is that a mutex has to wait while a compare exchange will never wait.</li>
</ul>
<h3 id="optimizing-spin-locks-for-high-contention"><a class="header" href="#optimizing-spin-locks-for-high-contention">Optimizing Spin Locks for High Contention</a></h3>
<ul>
<li>If we can have a value stay in the shared state while the lock is still held, that’s going to avoid all of the ownership bouncing.</li>
<li>Certain spin lock implementations use an inner loop that only reads values if they fail to take the lock. This allows values to stay in the shared state until some core takes exclusive access to them.</li>
<li>When there is high contention on a particular value with many threads or cores fighting over who gets exclusive access, performance may collapse. Avoiding this collapse by optimizing spin locks can lead to better performance curves.</li>
</ul>
<h2 id="compare-exchange-weak"><a class="header" href="#compare-exchange-weak">Compare Exchange Weak</a></h2>
<p>Section Overview: This section explains what compare exchange weak is and how it differs from regular compare exchange.</p>
<ul>
<li>Compare exchange weak is allowed to fail spuriously, even if the current value is what you passed in. Regular compare exchange is only allowed to fail if the current value did not match the value you passed in.</li>
<li>The difference between these two operations comes down to what operations the CPU supports. On Intel x86, there is a compare and swap operation that effectively implements compare exchange.</li>
</ul>
<h2 id="load-exclusive-and-store-exclusive"><a class="header" href="#load-exclusive-and-store-exclusive">Load Exclusive and Store Exclusive</a></h2>
<p>Section Overview: This section discusses the difference between compare and swap operations on x86 and ARM processors.</p>
<h3 id="load-exclusive-and-store-exclusive-1"><a class="header" href="#load-exclusive-and-store-exclusive-1">Load Exclusive and Store Exclusive</a></h3>
<ul>
<li>On ARM processors, instead of a compare and swap operation, there is a load exclusive (ldrex) and store exclusive (strex) operation.</li>
<li>Load exclusive takes exclusive ownership of the memory location and loads the value to you.</li>
<li>Store exclusive only works if you still have exclusive access to that location. If another thread has taken ownership of the value, it will fail.</li>
<li>Compare exchange on ARM is implemented using a loop of ldrex and strex because it needs to implement the semantics of comparexchange which is only fail if the current value stayed the same.</li>
<li>Compare exchange weak is allowed to fail spuriously so it can be implemented directly using ldrx and strx.</li>
</ul>
<h2 id="memory-ordering"><a class="header" href="#memory-ordering">Memory Ordering</a></h2>
<p>Section Overview: This section discusses how memory ordering affects observable behavior when multiple threads interact with a shared memory location.</p>
<h3 id="ordering-variants"><a class="header" href="#ordering-variants">Ordering Variants</a></h3>
<ul>
<li>There are different variants for ordering: relaxed, release, acquire, acquire-release, sequential consistency.</li>
<li>Relaxed means there are no guarantees about what happens when multiple threads interact with a shared memory location.</li>
<li>Release ensures that all previous writes become visible before any subsequent write or read from another thread occurs.</li>
<li>Acquire ensures that all previous reads become visible before any subsequent read or write from another thread occurs.</li>
<li>Acquire-release combines both acquire and release semantics.</li>
<li>Sequential consistency ensures that all operations appear to execute in a total order.</li>
</ul>
<h2 id="memory-barriers"><a class="header" href="#memory-barriers">Memory Barriers</a></h2>
<p>Section Overview: This section discusses memory barriers and how they can be used to enforce ordering constraints.</p>
<h3 id="memory-barriers-1"><a class="header" href="#memory-barriers-1">Memory Barriers</a></h3>
<ul>
<li>Memory barriers are instructions that enforce ordering constraints on memory operations.</li>
<li>There are two types of memory barriers: compiler barriers and hardware barriers.</li>
<li>Compiler barriers prevent the compiler from reordering memory operations across the barrier.</li>
<li>Hardware barriers ensure that all previous memory operations have completed before any subsequent operation is executed.</li>
<li>The C++11 standard defines several types of hardware barriers, including acquire, release, and full.</li>
</ul>
<h2 id="happens-before-relationship"><a class="header" href="#happens-before-relationship">Happens-Before Relationship</a></h2>
<p>Section Overview: This section discusses the happens-before relationship and how it relates to observable behavior when multiple threads interact with shared memory locations.</p>
<h3 id="happens-before-relationship-1"><a class="header" href="#happens-before-relationship-1">Happens-Before Relationship</a></h3>
<ul>
<li>The happens-before relationship is a partial order between events in a program that determines what values can be observed by other threads.</li>
<li>If event A happens before event B, then any value written by A must be visible to B.</li>
<li>If there is no happens-before relationship between two events, then their order is undefined.</li>
<li>Synchronizes-with is a special case of happens-before where one event synchronizes with another if it releases a mutex or semaphore that another thread acquires later.</li>
</ul>
<h2 id="lock-free-programming"><a class="header" href="#lock-free-programming">Lock-Free Programming</a></h2>
<p>Section Overview: This section discusses lock-free programming and its advantages and disadvantages.</p>
<h3 id="lock-free-programming-1"><a class="header" href="#lock-free-programming-1">Lock-Free Programming</a></h3>
<ul>
<li>Lock-free programming is a technique for writing concurrent programs without using locks.</li>
<li>The advantage of lock-free programming is that it can avoid the overhead of acquiring and releasing locks, which can be expensive.</li>
<li>The disadvantage of lock-free programming is that it can be more difficult to reason about and debug than lock-based programming.</li>
<li>Lock-free programming requires careful attention to memory ordering constraints and the happens-before relationship.</li>
</ul>
<h2 id="relaxed-ordering-in-rust"><a class="header" href="#relaxed-ordering-in-rust">Relaxed Ordering in Rust</a></h2>
<p>Section Overview: In this section, the speaker explains how relaxed ordering works in Rust and why it can lead to unexpected results.</p>
<h3 id="relaxed-ordering-and-thread-execution"><a class="header" href="#relaxed-ordering-and-thread-execution">Relaxed Ordering and Thread Execution</a></h3>
<ul>
<li>The speaker spawns two threads and creates an atomic variable x with size 0.</li>
<li>The speaker creates another atomic variable y with size 0.</li>
<li>Box leak returns a static mutable reference which cannot be moved into two threads. Therefore, the speaker casts it as an atomic variable.</li>
<li>The speaker creates two threads, x and y, both of which are numbers.</li>
<li>Thread 1 reads y with relaxed ordering and stores that value into x.</li>
<li>Thread 2 loads x and then stores 42 into y.</li>
<li>Both threads are joined so that we have the values t2.</li>
</ul>
<h3 id="explanation-of-relaxed-ordering"><a class="header" href="#explanation-of-relaxed-ordering">Explanation of Relaxed Ordering</a></h3>
<ul>
<li>It is possible for r1 to be equal to r2 be equal to 42. This is a possible execution of this program.</li>
<li>When multiple threads execute concurrently by default there are no guarantees about what values a thread can read from something another thread wrote under ordering relaxed.</li>
<li>There is a modification order stored per value in atomic operations. When you load a value with ordering relaxed you can see any value written by any thread to that location there’s no restriction on when that has to happen relative to you.</li>
<li>For example, when loading a value from x, it is allowed to see any value ever stored to x including 42 because it’s in the modification set of x and there are no constraints on which subset of that which range of that modification order is visible to this thread.</li>
<li>The compiler is totally allowed to reorder these two operations. Similarly, the CPU is allowed to execute them out of order for optimization purposes.</li>
<li>Under either of these conditions, the reverse execution might happen and if the code looks like this it’s totally obvious why r2 might be 42. With ordering relaxed you’re not guaranteed any ordering between threads.</li>
</ul>
<h2 id="reordering-and-speculative-execution"><a class="header" href="#reordering-and-speculative-execution">Reordering and Speculative Execution</a></h2>
<p>Section Overview: In this section, the speaker discusses how reordering makes sense in programming and how CPUs can execute operations speculatively. They also explain the constraints on what CPUs and compilers are allowed to reorder.</p>
<h3 id="reordering-in-programming"><a class="header" href="#reordering-in-programming">Reordering in Programming</a></h3>
<ul>
<li>Reordering lines of code that don’t depend on each other can make sense for programmers.</li>
<li>There is no downside to swapping two lines of code that don’t depend on each other.</li>
<li>Observable execution outcomes are different, but in the case of relaxed memory ordering, they’re interchangeable as far as the memory ordering specification is concerned.</li>
</ul>
<h3 id="speculative-execution"><a class="header" href="#speculative-execution">Speculative Execution</a></h3>
<ul>
<li>CPUs can run an operation before another one if it knows it’s about to be executed. This is called speculative execution.</li>
<li>Speculative execution usually comes up when there’s a question whether an operation might be executed or not.</li>
<li>Today’s CPUs are very good at out-of-order execution because it makes programs much faster.</li>
</ul>
<h3 id="constraints-on-reordering"><a class="header" href="#constraints-on-reordering">Constraints on Reordering</a></h3>
<ul>
<li>CPUs and compilers are allowed to reorder anything that doesn’t have a clear “happens before” relationship.</li>
<li>If two lines of code have a dependence relation (i.e., if one depends on the other), they cannot be reordered.</li>
<li>Memory ordering and semantics are not just about the CPU or architecture; they’re also about what the compiler is allowed to do.</li>
</ul>
<h2 id="exclusive-access-and-relaxed-memory-ordering"><a class="header" href="#exclusive-access-and-relaxed-memory-ordering">Exclusive Access and Relaxed Memory Ordering</a></h2>
<p>Section Overview: In this section, the speaker explains why relaxed memory ordering matters when taking locks with exclusive access.</p>
<h3 id="exclusive-access"><a class="header" href="#exclusive-access">Exclusive Access</a></h3>
<ul>
<li>If we already have exclusive access to a piece of memory, we can do an operation on it efficiently.</li>
<li>In the case of relaxed memory ordering, this can lead to shenanigans where operations are executed out of order.</li>
</ul>
<h3 id="relaxed-memory-ordering-and-locks"><a class="header" href="#relaxed-memory-ordering-and-locks">Relaxed Memory Ordering and Locks</a></h3>
<ul>
<li>Relaxed memory ordering doesn’t imply any ordering or that anything happens before anything else.</li>
<li>When taking locks with relaxed memory ordering, operations might execute while another thread is holding the lock, violating the exclusivity of immutable reference. This is bad for both the compiler and CPU.</li>
<li>The reordering we give determines whether an operation is legal or not.</li>
</ul>
<h2 id="memory-orderings-and-acquiringreleasing-resources"><a class="header" href="#memory-orderings-and-acquiringreleasing-resources">Memory Orderings and Acquiring/Releasing Resources</a></h2>
<p>Section Overview: This section discusses memory orderings in the context of acquiring or releasing a resource. It explains how the release ordering ensures that nothing moves below the lock, and how the acquire ordering guarantees that anything that happened before the store happens before anything that happens after the load.</p>
<h3 id="store-with-release-ordering"><a class="header" href="#store-with-release-ordering">Store with Release Ordering</a></h3>
<ul>
<li>A reordering is valid with relaxed, but not with release.</li>
<li>The release ordering ensures that nothing moves below the lock.</li>
<li>All previous operations become ordered before any load of this value with acquire or stronger ordering.</li>
</ul>
<h3 id="load-with-acquire-ordering"><a class="header" href="#load-with-acquire-ordering">Load with Acquire Ordering</a></h3>
<ul>
<li>Anything we do in here must be visible after an acquire load of the same value.</li>
<li>Whoever next takes the lock must see anything that happened before this store.</li>
<li>The acquire-release pair establishes a happens-before relationship between threads.</li>
</ul>
<h3 id="additional-restrictions"><a class="header" href="#additional-restrictions">Additional Restrictions</a></h3>
<ul>
<li>No reads or writes in the current thread can be reordered after a store operation with memory order release.</li>
<li>A load operation with memory order acquire performs the acquire operation on the effective memory location.</li>
</ul>
<h2 id="understanding-acquire-release-semantics"><a class="header" href="#understanding-acquire-release-semantics">Understanding Acquire-Release Semantics</a></h2>
<p>Section Overview: In this section, the speaker explains acquire-release semantics and how they are used in synchronization operations.</p>
<h3 id="acquire-release-semantics"><a class="header" href="#acquire-release-semantics">Acquire-Release Semantics</a></h3>
<ul>
<li>Acquire-release semantics are used in synchronization operations that involve a read and write operation.</li>
<li>The acquire-release semantics establish ordering between threads to ensure correct synchronization.</li>
<li>Acquire-release is commonly used for single modification operations where there is no critical section.</li>
<li>Sequentially consistent ordering is stronger than acquire-release.</li>
</ul>
<h3 id="compare-exchange-operation"><a class="header" href="#compare-exchange-operation">Compare Exchange Operation</a></h3>
<ul>
<li>The compare exchange operation has an extra parameter that specifies the ordering of the load if it indicates that you shouldn’t store.</li>
<li>Establishing a happens-before relationship between threads is important when taking a lock.</li>
<li>Relaxed memory semantics can be used when failing to take a lock does not require coordination with other threads.</li>
</ul>
<h3 id="testing-concurrent-code"><a class="header" href="#testing-concurrent-code">Testing Concurrent Code</a></h3>
<ul>
<li>x86_64 architecture guarantees acquire-release semantics for all operations, but this is not true for all platforms.</li>
<li>Testing concurrent code by running it multiple times on current hardware and compiler may not be representative of future executions.</li>
</ul>
<h2 id="relaxed-and-strong-memory-ordering"><a class="header" href="#relaxed-and-strong-memory-ordering">Relaxed and Strong Memory Ordering</a></h2>
<p>Section Overview: This section discusses the use of relaxed memory ordering when it doesn’t matter what each thread sees. It also introduces fetch operations as a gentler version of compare exchanges.</p>
<h3 id="relaxed-memory-ordering"><a class="header" href="#relaxed-memory-ordering">Relaxed Memory Ordering</a></h3>
<ul>
<li>Use relaxed memory ordering when it doesn’t matter what each thread sees.</li>
<li>For example, if you maintain a counter for statistics, you can generally have it be relaxed because the relative ordering of execution doesn’t really matter.</li>
<li>Relax imposes the least amount of restrictions on the CPU and compiler, allowing them to execute more efficiently.</li>
</ul>
<h3 id="fetch-operations"><a class="header" href="#fetch-operations">Fetch Operations</a></h3>
<ul>
<li>Fetch operations are gentler versions of compare exchanges.</li>
<li>They allow you to tell the CPU how to compute the new value instead of just dictating what the updated value should be.</li>
<li>Fetch ad is an example where you add one to the current value and store it back without failing.</li>
<li>Fetch update takes a closure that is given the current value and should return the new value.</li>
</ul>
<h2 id="fetch-operations-and-sequentially-consistent-ordering"><a class="header" href="#fetch-operations-and-sequentially-consistent-ordering">Fetch Operations and Sequentially Consistent Ordering</a></h2>
<p>Section Overview: This section explains how fetch operations work in combination with sequentially consistent ordering.</p>
<h3 id="sequentially-consistent-ordering"><a class="header" href="#sequentially-consistent-ordering">Sequentially Consistent Ordering</a></h3>
<ul>
<li>Sequentially consistent ordering ensures that all threads see a consistent order of events.</li>
<li>It’s useful when there are dependencies between threads or instructions.</li>
</ul>
<h3 id="fetch-operations-with-sequentially-consistent-ordering"><a class="header" href="#fetch-operations-with-sequentially-consistent-ordering">Fetch Operations with Sequentially Consistent Ordering</a></h3>
<ul>
<li>When using fetch operations with sequentially consistent ordering, they behave like acquire-release semantics.</li>
<li>The operation has both an acquire effect on any previous memory accesses by other threads and a release effect on any subsequent memory accesses by other threads.</li>
</ul>
<h2 id="understanding-fetch-operations"><a class="header" href="#understanding-fetch-operations">Understanding Fetch Operations</a></h2>
<p>Section Overview: In this section, the speaker explains what fetch operations are and how they work.</p>
<h3 id="fetch-update"><a class="header" href="#fetch-update">Fetch Update</a></h3>
<ul>
<li><code>fetch_update</code> loads the current value and does a compare exchange in a loop.</li>
<li>It is not the same as other fetch operations because it uses a compare exchange loop.</li>
<li>Atomic types in Rust’s atomic module are guaranteed to be lock-free if available.</li>
</ul>
<h3 id="unique-sequence-numbers"><a class="header" href="#unique-sequence-numbers">Unique Sequence Numbers</a></h3>
<ul>
<li>Fetch operations are used for things like giving unique sequence numbers to concurrent operations.</li>
<li>Using <code>fetch_add</code> on an atomic usize guarantees that every call to get a sequence number will get a distinct one.</li>
</ul>
<h2 id="sequentially-consistent-ordering-1"><a class="header" href="#sequentially-consistent-ordering-1">Sequentially Consistent Ordering</a></h2>
<p>Section Overview: In this section, the speaker discusses sequentially consistent ordering and provides an example to demonstrate its difference from acquire-release ordering.</p>
<h3 id="example-with-atomic-bools-and-usize"><a class="header" href="#example-with-atomic-bools-and-usize">Example with Atomic Bools and Usize</a></h3>
<ul>
<li>The example involves two threads storing values in atomic bools and one thread doing a fetch add on an atomic usize.</li>
<li>One thread stores true with ordering release while another stores y with no specified ordering.</li>
<li>A third thread does while not x load, acquires in a loop, checks if y again will acquire, then fetch adds one to z which is relaxed.</li>
</ul>
<h2 id="possible-values-for-z"><a class="header" href="#possible-values-for-z">Possible Values for Z</a></h2>
<p>Section Overview: In this section, the speaker discusses possible values for z in a given code snippet.</p>
<h3 id="two-is-possible"><a class="header" href="#two-is-possible">Two is Possible</a></h3>
<ul>
<li>Execution order: t x ty t1 t2</li>
<li>X is true and Y is true, so Z increments by 1 twice.</li>
<li>Therefore, Z equals 2.</li>
</ul>
<h3 id="one-is-possible"><a class="header" href="#one-is-possible">One is Possible</a></h3>
<ul>
<li>Execution order: tx t1 t2 ty t2</li>
<li>X is true but Y is false when T1 runs, so it does not increment Z.</li>
<li>When Ty runs, it sets Y to true.</li>
<li>When T2 runs, it sees that both X and Y are true and increments Z by 1.</li>
<li>Therefore, Z equals 1.</li>
</ul>
<h3 id="zero-may-not-be-possible"><a class="header" href="#zero-may-not-be-possible">Zero May Not Be Possible</a></h3>
<ul>
<li>To achieve zero as the value of Z:
<ul>
<li>T1 must run after Tx.</li>
<li>T2 must run after Ty.</li>
<li>There are no other restrictions on execution order.</li>
</ul>
</li>
</ul>
<h2 id="mutex-panic-safety"><a class="header" href="#mutex-panic-safety">Mutex Panic Safety</a></h2>
<p>Section Overview: In this section, the speaker answers a question about mutex panic safety.</p>
<ul>
<li>The mutex is panic safe but will not propagate panics.</li>
</ul>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h2>
<p>Section Overview: In this section, the speaker discusses a pattern and execution order for threads.</p>
<h3 id="thread-execution-order"><a class="header" href="#thread-execution-order">Thread Execution Order</a></h3>
<ul>
<li>The speaker explains that if t2 goes here, then ty must go before that and t1 will increment c because it runs after x and y have both been set to true.</li>
<li>If t2 goes after tx, ty still has to go before t2 is going to get to do anything useful. In either case, t1 and t2 will increment z because they’re both going to go after the things that set x and y.</li>
<li>If we place t2 at the end, ty could go here but if ty goes there then tx is already run so t2 will increment z. If ty went earlier, t2 would still increment c so there’s no place given this restriction where one of them won’t increment z. It seems impossible to have a thread schedule where z equals zero.</li>
</ul>
<h2 id="thread-schedules"><a class="header" href="#thread-schedules">Thread Schedules</a></h2>
<p>Section Overview: In this section, the speaker talks about thread schedules and how computers don’t have a single order that things run in.</p>
<h3 id="thread-schedules-1"><a class="header" href="#thread-schedules-1">Thread Schedules</a></h3>
<ul>
<li>The speaker explains that thread schedules are just like the human desire to put things in order but in reality computers don’t have a single order that things run in.</li>
<li>We have multiple cores and those cores can show old values new values all we’re subject to are the exact rules of acquire and release semantics which is what we’ve given here.</li>
<li>There’s no requirement that we see anything that happened in another thread. When you spawn a thread these threads all happen after the main thread that spawned them so we must actually see this false it’s not like we could see a value written somewhere else independently but we must see this false or anything that happens later we can’t see if imagine that this thread did like x dot store true then the loads down here must see the store because it happened before them.</li>
</ul>
<h2 id="acquire-and-release-semantics"><a class="header" href="#acquire-and-release-semantics">Acquire and Release Semantics</a></h2>
<p>Section Overview: In this section, the speaker talks about acquire and release semantics.</p>
<h3 id="acquire-and-release-semantics-1"><a class="header" href="#acquire-and-release-semantics-1">Acquire and Release Semantics</a></h3>
<ul>
<li>The speaker explains that if you observe a value from acquire you will see all operations that happen before the corresponding release store while the corresponding release store is here in this thread there are no operations prior to the store but if there were we would be guaranteed to see them here because we’re synchronizing with tx but there are none.</li>
<li>This load synchronizes with this store so after this load we must see all memory operations that happened before this store. There’s no requirement that that’s any particular store of why if there had been a store of y in this thread if this did y dot store we must observe that y dot store because it happened strictly before this store which happened before this load because of acquire release so if there was a store here we must see it but there isn’t so we’re allowed to see any value for y.</li>
</ul>
<h2 id="memory-ordering-in-rust"><a class="header" href="#memory-ordering-in-rust">Memory Ordering in Rust</a></h2>
<p>Section Overview: This section discusses memory ordering in Rust and how it affects concurrent operations.</p>
<h3 id="happens-before-relationship-2"><a class="header" href="#happens-before-relationship-2">Happens Before Relationship</a></h3>
<ul>
<li>When a thread runs, it synchronizes with other threads but there is no requirement that it sees any particular operation that happened to x because there’s no happens before relationship between the store here in tx and the load down here.</li>
<li>Acquire loads says that you’re not allowed to move any operation from below to above an acquire load so the compiler is not allowed to reorder these by the acquire semantics.</li>
<li>The load is allowed to see any previous value for x subject to happens before which does not include the operation of t y so therefore uh t2 must see this.</li>
</ul>
<h3 id="concurrent-operations"><a class="header" href="#concurrent-operations">Concurrent Operations</a></h3>
<ul>
<li>T2 can see either of these and T1 can see either of these. If both threads run, then T1 runs, observes x being true but does not observe y being true even though T1 has run because there’s no happens before relationship there.</li>
<li>Imagine that it’s already in cache in the CPU or something; it just uses that value. It doesn’t bother to check again because it’s allowed not to. Therefore, this value is false even though Tx Ty ran; therefore, it does not increment one this one for some reason like it spins until y is true.</li>
<li>It observes that y is true great. It’s no requirement that it observes that x is true even though Tx has run so it does not increment c so therefore z is zero.</li>
</ul>
<h3 id="sequentially-consistent-operation"><a class="header" href="#sequentially-consistent-operation">Sequentially Consistent Operation</a></h3>
<ul>
<li>Sexy as t (pronounced “sequentially consistent”) means acquire and release and acquire release with the additional guarantee that all threads see all sequentially consistent operations in the same order. If we make these all be sequentially consistent now, zero is no longer possible because if this thread observes that x observes x is true and then y is true, it establishes a happens before relationship.</li>
</ul>
<h2 id="memory-ordering-and-sequential-consistency"><a class="header" href="#memory-ordering-and-sequential-consistency">Memory Ordering and Sequential Consistency</a></h2>
<p>Section Overview: This section discusses memory ordering and sequential consistency in concurrent programming.</p>
<h3 id="memory-ordering-1"><a class="header" href="#memory-ordering-1">Memory Ordering</a></h3>
<ul>
<li>In concurrent programming, there must exist some ordering that’s consistent across all threads.</li>
<li>If some thread sees that x happened then y happened, then no thread is allowed to see x not happen even though y has happened.</li>
<li>If we end up with x is true and then y is true, then here y is true therefore x must be true. It’s not allowed to see x being false because that would be inconsistent with the memory ordering that these sequentially consistent operations saw.</li>
<li>The sequentially consistent ordering is only with relation to all other sequentially consistent operations.</li>
<li>Sequentially consistent only really interacts with other sequentially consistent acquire release does interact with sequentially consistent so sequentially consistent it is always stronger than acquire release.</li>
</ul>
<h3 id="testing-concurrent-code-1"><a class="header" href="#testing-concurrent-code-1">Testing Concurrent Code</a></h3>
<ul>
<li>Memory ordering is real subtle and hard to get right.</li>
<li>Running your code lots of times in a loop or making your computer busy with other tasks can help test for errors but it’s not reliable since it might depend on the architecture, operating system scheduler, compiler optimizations, or how likely the error occurs.</li>
<li>Detecting bugs in concurrent code can be difficult since they may not cause a program crash or may go unnoticed for a long time.</li>
</ul>
<h2 id="detecting-concurrency-problems"><a class="header" href="#detecting-concurrency-problems">Detecting Concurrency Problems</a></h2>
<p>Section Overview: This section discusses the need to detect concurrency problems and some automated systems that can help with this.</p>
<h3 id="thread-sanitizer"><a class="header" href="#thread-sanitizer">Thread Sanitizer</a></h3>
<ul>
<li>Google has built-in sanitizers in compilers like Clang, GCC, and MSVC.</li>
<li>The thread sanitizer is one of these sanitizers.</li>
<li>It detects unsynchronized operations on a single memory location by tracking every load and store operation in a program.</li>
<li>The algorithm for the thread sanitizer is specified in the documentation.</li>
</ul>
<h3 id="loom"><a class="header" href="#loom">Loom</a></h3>
<ul>
<li>Loom is a tool that implements the CDS Checker paper for Rust.</li>
<li>It takes a concurrent program, instruments it using loom synchronization and atomic types instead of standard library ones, and runs it multiple times to expose it to different possible executions.</li>
<li>Loom executes all possible thread interleavings and memory orderings to ensure that all legal executions of the program are explored.</li>
</ul>
<h2 id="loom-a-tool-for-testing-concurrent-code"><a class="header" href="#loom-a-tool-for-testing-concurrent-code">Loom: A Tool for Testing Concurrent Code</a></h2>
<p>Section Overview: In this section, the speaker talks about Loom, a tool used to test concurrent code. The speaker explains that Loom explores all possible legal executions of threads and implements a bunch of implementation things from the paper to reduce the number of possible executions.</p>
<h3 id="exploring-all-possible-legal-executions"><a class="header" href="#exploring-all-possible-legal-executions">Exploring All Possible Legal Executions</a></h3>
<ul>
<li>Loom explores all possible legal executions of threads.</li>
<li>There might be an insane number of such possible executions.</li>
<li>Loom has a bunch of implementation things that are from the paper that looks at reducing those.</li>
</ul>
<h3 id="limitations-of-loom"><a class="header" href="#limitations-of-loom">Limitations of Loom</a></h3>
<ul>
<li>Ultimately, there’s like a limit to how complex your test cases can be when you run them on the loop loom.</li>
<li>Even so, loom is the best tool I know of to try to make sure that your concurrent code is actually correct under only the assumptions that the memory model gives you rather than the assumptions that the current compiler or optimization or CPU might give you.</li>
</ul>
<h2 id="examples-for-sequentially-consistent-ordering"><a class="header" href="#examples-for-sequentially-consistent-ordering">Examples for Sequentially Consistent Ordering</a></h2>
<p>Section Overview: In this section, someone asks if there are any toy programs one can think of to try and drill sequentially consistent ordering into their head. The speaker recommends looking at some papers that implement concurrent data structures and notice where they use sequentially consistent ordering as opposed to other orderings.</p>
<h3 id="no-less-contrived-example-available"><a class="header" href="#no-less-contrived-example-available">No Less Contrived Example Available</a></h3>
<ul>
<li>The speaker doesn’t have a less contrived example for sequentially consistent ordering.</li>
</ul>
<h3 id="recommendation"><a class="header" href="#recommendation">Recommendation</a></h3>
<ul>
<li>Look at some papers that implement concurrent data structures and notice where they use sequentially consistent ordering as opposed to other orderings.</li>
<li>Generally, the paper will explain why.</li>
</ul>
<h2 id="limitations-of-zulu"><a class="header" href="#limitations-of-zulu">Limitations of Zulu</a></h2>
<p>Section Overview: In this section, the speaker talks about some limitations of Zulu and how relaxed ordering is so relaxed that you can’t fully model all possible executions even with something like Loom.</p>
<h3 id="limitations-of-zulu-1"><a class="header" href="#limitations-of-zulu-1">Limitations of Zulu</a></h3>
<ul>
<li>Zulu has some limitations, some of them are known problems, some of them are more fundamental problems with the approach or are just impossible to model.</li>
<li>Relaxed ordering is so relaxed that you can’t fully model all possible executions even with something like Loom.</li>
</ul>
<h3 id="example-for-relaxed-ordering"><a class="header" href="#example-for-relaxed-ordering">Example for Relaxed Ordering</a></h3>
<ul>
<li>The speaker gives an example where loom has to produce some value for a load but doesn’t know about it yet because it hasn’t happened yet.</li>
</ul>
<h2 id="contributing-to-loom"><a class="header" href="#contributing-to-loom">Contributing to Loom</a></h2>
<p>Section Overview: This section discusses the benefits of contributing to Loom, a project that deals with concurrency. It also highlights some of the limitations of Loom and how contributions can help improve it.</p>
<h3 id="benefits-of-contributing-to-loom"><a class="header" href="#benefits-of-contributing-to-loom">Benefits of Contributing to Loom</a></h3>
<ul>
<li>The speaker encourages people interested in concurrency to contribute to Loom.</li>
<li>The documentation for Loom has been recently updated and is recommended reading for anyone interested in using or contributing to the project.</li>
<li>Tokyo uses Loom and has caught several critical bugs, making it an important tool for detecting issues.</li>
</ul>
<h3 id="limitations-of-loom-1"><a class="header" href="#limitations-of-loom-1">Limitations of Loom</a></h3>
<ul>
<li>Currently, Loom does not model sequentially consistent ordering correctly.</li>
<li>Implementing the additional guarantees required for sequentially consistent ordering is complex.</li>
<li>Downgrading every sequentially consistent order to acquire release means that while Loom won’t miss any bugs, it might give false positives.</li>
</ul>
<h3 id="how-contributions-can-help"><a class="header" href="#how-contributions-can-help">How Contributions Can Help</a></h3>
<ul>
<li>There is an open issue and test case for modeling sequentially consistent ordering correctly that needs fixing.</li>
<li>Contributions towards improving documentation are highly encouraged.</li>
</ul>
<h2 id="testing-sequentially-consistent-ordering-with-acquire-release"><a class="header" href="#testing-sequentially-consistent-ordering-with-acquire-release">Testing Sequentially Consistent Ordering with Acquire Release</a></h2>
<p>Section Overview: This section explains how testing sequential consistency with acquire release works in Loom.</p>
<h3 id="testing-sequential-consistency-with-acquire-release"><a class="header" href="#testing-sequential-consistency-with-acquire-release">Testing Sequential Consistency with Acquire Release</a></h3>
<ul>
<li>If code depends on sequential consistency but is tested using acquire release, there may be false positives when using Loom.</li>
<li>However, running code through Loom will catch real errors and explore possible cases with acquire release.</li>
</ul>
<h2 id="overview-of-loom-and-relaxed-ordering"><a class="header" href="#overview-of-loom-and-relaxed-ordering">Overview of Loom and Relaxed Ordering</a></h2>
<p>Section Overview: In this section, the speaker provides an overview of Loom and relaxed ordering.</p>
<h3 id="atomic-module-in-sender-library"><a class="header" href="#atomic-module-in-sender-library">Atomic Module in Sender Library</a></h3>
<ul>
<li>The atomic module in the sender library contains atomic types, constants, and three functions: spin loop hint, compiler fence, and fence.</li>
<li>Spin loop hint is deprecated and has been moved to the hint module. It is used in atomic contexts such as a spin lock.</li>
<li>Compiler fence ensures that the compiler won’t move a given load or store operation above or below a fence within that thread’s execution. It is mostly used for preventing a thread from racing with itself when using signal handlers.</li>
<li>Fence establishes a happens before relationship between two threads without talking about a particular memory location. It synchronizes with all other threads that are doing an offense.</li>
</ul>
<h3 id="memory-ordering-2"><a class="header" href="#memory-ordering-2">Memory Ordering</a></h3>
<ul>
<li>Load acquire synchronizes or happens after store release of the same memory location.</li>
<li>Fence is basically an atomic operation that establishes a happens before relationship between two threads but without talking about a particular memory location.</li>
</ul>
<h2 id="volatile-keyword"><a class="header" href="#volatile-keyword">Volatile Keyword</a></h2>
<p>Section Overview: In this section, the speaker explains why there is no mention of volatile in the atomic module.</p>
<h3 id="volatile-keyword-1"><a class="header" href="#volatile-keyword-1">Volatile Keyword</a></h3>
<ul>
<li>There is no mention of volatile in the atomic module because it is just unrelated to atomics.</li>
</ul>
<h2 id="understanding-volatile"><a class="header" href="#understanding-volatile">Understanding Volatile</a></h2>
<p>Section Overview: In this section, the speaker explains what volatile is and its purpose.</p>
<h3 id="what-is-volatile"><a class="header" href="#what-is-volatile">What is Volatile?</a></h3>
<ul>
<li>Volatile is used when interacting with memory-mapped devices.</li>
<li>It ensures that operations cannot be reordered relative to other operations.</li>
<li>If you read twice from a given variable in memory map memory without using read volatile, the compiler would cache the first read into register and just read from the register for the second read. However, both reads need to go to memory to have a side effect on device map memory.</li>
</ul>
<h2 id="atomic-pointer"><a class="header" href="#atomic-pointer">Atomic Pointer</a></h2>
<p>Section Overview: In this section, the speaker explains atomic pointer and how it differs from other types.</p>
<h2 id="what-is-atomic-pointer"><a class="header" href="#what-is-atomic-pointer">What is Atomic Pointer?</a></h2>
<ul>
<li>Atomic pointer is an atomic usize where methods are specialized to the underlying type being a pointer.</li>
<li>It provides load, store, compare exchange and fetch update which is like having a nicer interface to doing a compare exchange loop.
[<em>CUTOFF_LIMIT</em>]</li>
</ul>
<h1 id="generated-by-video-highlight"><a class="header" href="#generated-by-video-highlight">Generated by Video Highlight</a></h1>
<p>https://videohighlight.com/video/summary/rMGWeSjctlY</p>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../../rust_video_summary/curst_of_rust/async_await.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../rust_video_summary/curst_of_rust/channels.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../../rust_video_summary/curst_of_rust/async_await.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../../rust_video_summary/curst_of_rust/channels.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>



    <script type="text/javascript">
        window.playground_line_numbers = true;
    </script>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="../../book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="../../assets/ferris/ferris.js"></script>
    <script type="text/javascript" src="../../assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="../../assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="../../assets/smart-anchor.js"></script>
    <script type="text/javascript" src="../../assets/pagetoc/sidebar.js"></script>

</body>
</html>
